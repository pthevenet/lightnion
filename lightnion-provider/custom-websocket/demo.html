<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Websocket Redirection</title>
    <link rel="stylesheet" href="../ws_style.css">

    <!-- lightnion client -->
    <script src='../lightnion.bundle.js'></script>
    <script src='../lightnion-helpers.js'></script>

    <script src="parsing.js"></script>
    <script src="packets.js"></script>

    <!-- TLS/HTTP library -->
    <script src="../jquery.min.js"></script>
    <script src="../forge.all.js"></script>

</head>

<body onload="focus()">
    <script src="custom-websocket.js"></script>
    <script src="lws.js"></script>

    <h1>Websocket Redirection</h1>

    <script>
        // redefine websocket
        _WebSocket = WebSocket;
        WebSocket = LWS;
        // let url = new URL("ws://demos.kaazing.com/echo");
        // let ws = new WebSocket(url, []);
    </script>

    <ul id="messages"></ul>
    <form id="echo-form" action="javascript:void(0);">
        <input id="echo-input" autocomplete="off" />
        <button type="button" id="echo-button" onclick="sendMessage()">Send</button>
    </form>

    <script>
    
        // create websocket as normal
        let url = new URL("ws://demos.kaazing.com/echo");
        let ws = new WebSocket(url);

        // send message in input through websocket
        function sendMessage() {
            let msg = document.getElementById("echo-input").value;
            document.getElementById("echo-input").value = "";
            appendMessage(msg);
            ws.send(msg);
        }
        
        // add a message to the frontend
        function appendMessage(msg) {
            var ul = document.getElementById("messages");
            var li = document.createElement("li");
            li.appendChild(document.createTextNode(msg));
            ul.appendChild(li);
        }

        ws.onmessage = function (smth) {
            onMessage(smth);
        }
        
    </script>

</body>

</html>