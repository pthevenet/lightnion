!function(r){"use strict";function t(r,t,n,e){r[t]=n>>24&255,r[t+1]=n>>16&255,r[t+2]=n>>8&255,r[t+3]=255&n,r[t+4]=e>>24&255,r[t+5]=e>>16&255,r[t+6]=e>>8&255,r[t+7]=255&e}function n(r,t,n,e,o){var i,h=0;for(i=0;i<o;i++)h|=r[t+i]^n[e+i];return(1&h-1>>>8)-1}function e(r,t,e,o){return n(r,t,e,o,16)}function o(r,t,e,o){return n(r,t,e,o,32)}function i(r,t,n,e){for(var o,i=255&e[0]|(255&e[1])<<8|(255&e[2])<<16|(255&e[3])<<24,h=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,a=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,f=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,s=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,u=255&e[4]|(255&e[5])<<8|(255&e[6])<<16|(255&e[7])<<24,c=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,y=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,l=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,w=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,v=255&e[8]|(255&e[9])<<8|(255&e[10])<<16|(255&e[11])<<24,p=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,b=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,g=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,_=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,A=255&e[12]|(255&e[13])<<8|(255&e[14])<<16|(255&e[15])<<24,U=i,d=h,E=a,x=f,M=s,m=u,B=c,S=y,K=l,Y=w,k=v,T=p,L=b,z=g,R=_,P=A,N=0;N<20;N+=2)o=U+L|0,M^=o<<7|o>>>25,o=M+U|0,K^=o<<9|o>>>23,o=K+M|0,L^=o<<13|o>>>19,o=L+K|0,U^=o<<18|o>>>14,o=m+d|0,Y^=o<<7|o>>>25,o=Y+m|0,z^=o<<9|o>>>23,o=z+Y|0,d^=o<<13|o>>>19,o=d+z|0,m^=o<<18|o>>>14,o=k+B|0,R^=o<<7|o>>>25,o=R+k|0,E^=o<<9|o>>>23,o=E+R|0,B^=o<<13|o>>>19,o=B+E|0,k^=o<<18|o>>>14,o=P+T|0,x^=o<<7|o>>>25,o=x+P|0,S^=o<<9|o>>>23,o=S+x|0,T^=o<<13|o>>>19,o=T+S|0,P^=o<<18|o>>>14,o=U+x|0,d^=o<<7|o>>>25,o=d+U|0,E^=o<<9|o>>>23,o=E+d|0,x^=o<<13|o>>>19,o=x+E|0,U^=o<<18|o>>>14,o=m+M|0,B^=o<<7|o>>>25,o=B+m|0,S^=o<<9|o>>>23,o=S+B|0,M^=o<<13|o>>>19,o=M+S|0,m^=o<<18|o>>>14,o=k+Y|0,T^=o<<7|o>>>25,o=T+k|0,K^=o<<9|o>>>23,o=K+T|0,Y^=o<<13|o>>>19,o=Y+K|0,k^=o<<18|o>>>14,o=P+R|0,L^=o<<7|o>>>25,o=L+P|0,z^=o<<9|o>>>23,o=z+L|0,R^=o<<13|o>>>19,o=R+z|0,P^=o<<18|o>>>14;U=U+i|0,d=d+h|0,E=E+a|0,x=x+f|0,M=M+s|0,m=m+u|0,B=B+c|0,S=S+y|0,K=K+l|0,Y=Y+w|0,k=k+v|0,T=T+p|0,L=L+b|0,z=z+g|0,R=R+_|0,P=P+A|0,r[0]=U>>>0&255,r[1]=U>>>8&255,r[2]=U>>>16&255,r[3]=U>>>24&255,r[4]=d>>>0&255,r[5]=d>>>8&255,r[6]=d>>>16&255,r[7]=d>>>24&255,r[8]=E>>>0&255,r[9]=E>>>8&255,r[10]=E>>>16&255,r[11]=E>>>24&255,r[12]=x>>>0&255,r[13]=x>>>8&255,r[14]=x>>>16&255,r[15]=x>>>24&255,r[16]=M>>>0&255,r[17]=M>>>8&255,r[18]=M>>>16&255,r[19]=M>>>24&255,r[20]=m>>>0&255,r[21]=m>>>8&255,r[22]=m>>>16&255,r[23]=m>>>24&255,r[24]=B>>>0&255,r[25]=B>>>8&255,r[26]=B>>>16&255,r[27]=B>>>24&255,r[28]=S>>>0&255,r[29]=S>>>8&255,r[30]=S>>>16&255,r[31]=S>>>24&255,r[32]=K>>>0&255,r[33]=K>>>8&255,r[34]=K>>>16&255,r[35]=K>>>24&255,r[36]=Y>>>0&255,r[37]=Y>>>8&255,r[38]=Y>>>16&255,r[39]=Y>>>24&255,r[40]=k>>>0&255,r[41]=k>>>8&255,r[42]=k>>>16&255,r[43]=k>>>24&255,r[44]=T>>>0&255,r[45]=T>>>8&255,r[46]=T>>>16&255,r[47]=T>>>24&255,r[48]=L>>>0&255,r[49]=L>>>8&255,r[50]=L>>>16&255,r[51]=L>>>24&255,r[52]=z>>>0&255,r[53]=z>>>8&255,r[54]=z>>>16&255,r[55]=z>>>24&255,r[56]=R>>>0&255,r[57]=R>>>8&255,r[58]=R>>>16&255,r[59]=R>>>24&255,r[60]=P>>>0&255,r[61]=P>>>8&255,r[62]=P>>>16&255,r[63]=P>>>24&255}function h(r,t,n,e){for(var o,i=255&e[0]|(255&e[1])<<8|(255&e[2])<<16|(255&e[3])<<24,h=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,a=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,f=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,s=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,u=255&e[4]|(255&e[5])<<8|(255&e[6])<<16|(255&e[7])<<24,c=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,y=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,l=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,w=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,v=255&e[8]|(255&e[9])<<8|(255&e[10])<<16|(255&e[11])<<24,p=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,b=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,g=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,_=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,A=255&e[12]|(255&e[13])<<8|(255&e[14])<<16|(255&e[15])<<24,U=i,d=h,E=a,x=f,M=s,m=u,B=c,S=y,K=l,Y=w,k=v,T=p,L=b,z=g,R=_,P=A,N=0;N<20;N+=2)o=U+L|0,M^=o<<7|o>>>25,o=M+U|0,K^=o<<9|o>>>23,o=K+M|0,L^=o<<13|o>>>19,o=L+K|0,U^=o<<18|o>>>14,o=m+d|0,Y^=o<<7|o>>>25,o=Y+m|0,z^=o<<9|o>>>23,o=z+Y|0,d^=o<<13|o>>>19,o=d+z|0,m^=o<<18|o>>>14,o=k+B|0,R^=o<<7|o>>>25,o=R+k|0,E^=o<<9|o>>>23,o=E+R|0,B^=o<<13|o>>>19,o=B+E|0,k^=o<<18|o>>>14,o=P+T|0,x^=o<<7|o>>>25,o=x+P|0,S^=o<<9|o>>>23,o=S+x|0,T^=o<<13|o>>>19,o=T+S|0,P^=o<<18|o>>>14,o=U+x|0,d^=o<<7|o>>>25,o=d+U|0,E^=o<<9|o>>>23,o=E+d|0,x^=o<<13|o>>>19,o=x+E|0,U^=o<<18|o>>>14,o=m+M|0,B^=o<<7|o>>>25,o=B+m|0,S^=o<<9|o>>>23,o=S+B|0,M^=o<<13|o>>>19,o=M+S|0,m^=o<<18|o>>>14,o=k+Y|0,T^=o<<7|o>>>25,o=T+k|0,K^=o<<9|o>>>23,o=K+T|0,Y^=o<<13|o>>>19,o=Y+K|0,k^=o<<18|o>>>14,o=P+R|0,L^=o<<7|o>>>25,o=L+P|0,z^=o<<9|o>>>23,o=z+L|0,R^=o<<13|o>>>19,o=R+z|0,P^=o<<18|o>>>14;r[0]=U>>>0&255,r[1]=U>>>8&255,r[2]=U>>>16&255,r[3]=U>>>24&255,r[4]=m>>>0&255,r[5]=m>>>8&255,r[6]=m>>>16&255,r[7]=m>>>24&255,r[8]=k>>>0&255,r[9]=k>>>8&255,r[10]=k>>>16&255,r[11]=k>>>24&255,r[12]=P>>>0&255,r[13]=P>>>8&255,r[14]=P>>>16&255,r[15]=P>>>24&255,r[16]=B>>>0&255,r[17]=B>>>8&255,r[18]=B>>>16&255,r[19]=B>>>24&255,r[20]=S>>>0&255,r[21]=S>>>8&255,r[22]=S>>>16&255,r[23]=S>>>24&255,r[24]=K>>>0&255,r[25]=K>>>8&255,r[26]=K>>>16&255,r[27]=K>>>24&255,r[28]=Y>>>0&255,r[29]=Y>>>8&255,r[30]=Y>>>16&255,r[31]=Y>>>24&255}function a(r,t,n,e){i(r,t,n,e)}function f(r,t,n,e){h(r,t,n,e)}function s(r,t,n,e,o,i,h){var f,s,u=new Uint8Array(16),c=new Uint8Array(64);for(s=0;s<16;s++)u[s]=0;for(s=0;s<8;s++)u[s]=i[s];for(;o>=64;){for(a(c,u,h,cr),s=0;s<64;s++)r[t+s]=n[e+s]^c[s];for(f=1,s=8;s<16;s++)f=f+(255&u[s])|0,u[s]=255&f,f>>>=8;o-=64,t+=64,e+=64}if(o>0)for(a(c,u,h,cr),s=0;s<o;s++)r[t+s]=n[e+s]^c[s];return 0}function u(r,t,n,e,o){var i,h,f=new Uint8Array(16),s=new Uint8Array(64);for(h=0;h<16;h++)f[h]=0;for(h=0;h<8;h++)f[h]=e[h];for(;n>=64;){for(a(s,f,o,cr),h=0;h<64;h++)r[t+h]=s[h];for(i=1,h=8;h<16;h++)i=i+(255&f[h])|0,f[h]=255&i,i>>>=8;n-=64,t+=64}if(n>0)for(a(s,f,o,cr),h=0;h<n;h++)r[t+h]=s[h];return 0}function c(r,t,n,e,o){var i=new Uint8Array(32);f(i,e,o,cr);for(var h=new Uint8Array(8),a=0;a<8;a++)h[a]=e[a+16];return u(r,t,n,h,i)}function y(r,t,n,e,o,i,h){var a=new Uint8Array(32);f(a,i,h,cr);for(var u=new Uint8Array(8),c=0;c<8;c++)u[c]=i[c+16];return s(r,t,n,e,o,u,a)}function l(r,t,n,e,o,i){var h=new yr(i);return h.update(n,e,o),h.finish(r,t),0}function w(r,t,n,o,i,h){var a=new Uint8Array(16);return l(a,0,n,o,i,h),e(r,t,a,0)}function v(r,t,n,e,o){var i;if(n<32)return-1;for(y(r,0,t,0,n,e,o),l(r,16,r,32,n-32,r),i=0;i<16;i++)r[i]=0;return 0}function p(r,t,n,e,o){var i,h=new Uint8Array(32);if(n<32)return-1;if(c(h,0,32,e,o),0!==w(t,16,t,32,n-32,h))return-1;for(y(r,0,t,0,n,e,o),i=0;i<32;i++)r[i]=0;return 0}function b(r,t){var n;for(n=0;n<16;n++)r[n]=0|t[n]}function g(r){var t,n,e=1;for(t=0;t<16;t++)n=r[t]+e+65535,e=Math.floor(n/65536),r[t]=n-65536*e;r[0]+=e-1+37*(e-1)}function _(r,t,n){for(var e,o=~(n-1),i=0;i<16;i++)e=o&(r[i]^t[i]),r[i]^=e,t[i]^=e}function A(r,t){var n,e,o,i=$(),h=$();for(n=0;n<16;n++)h[n]=t[n];for(g(h),g(h),g(h),e=0;e<2;e++){for(i[0]=h[0]-65517,n=1;n<15;n++)i[n]=h[n]-65535-(i[n-1]>>16&1),i[n-1]&=65535;i[15]=h[15]-32767-(i[14]>>16&1),o=i[15]>>16&1,i[14]&=65535,_(h,i,1-o)}for(n=0;n<16;n++)r[2*n]=255&h[n],r[2*n+1]=h[n]>>8}function U(r,t){var n=new Uint8Array(32),e=new Uint8Array(32);return A(n,r),A(e,t),o(n,0,e,0)}function d(r){var t=new Uint8Array(32);return A(t,r),1&t[0]}function E(r,t){var n;for(n=0;n<16;n++)r[n]=t[2*n]+(t[2*n+1]<<8);r[15]&=32767}function x(r,t,n){for(var e=0;e<16;e++)r[e]=t[e]+n[e]}function M(r,t,n){for(var e=0;e<16;e++)r[e]=t[e]-n[e]}function m(r,t,n){var e,o,i=0,h=0,a=0,f=0,s=0,u=0,c=0,y=0,l=0,w=0,v=0,p=0,b=0,g=0,_=0,A=0,U=0,d=0,E=0,x=0,M=0,m=0,B=0,S=0,K=0,Y=0,k=0,T=0,L=0,z=0,R=0,P=n[0],N=n[1],O=n[2],C=n[3],F=n[4],I=n[5],G=n[6],Z=n[7],q=n[8],V=n[9],X=n[10],D=n[11],j=n[12],H=n[13],J=n[14],Q=n[15];e=t[0],i+=e*P,h+=e*N,a+=e*O,f+=e*C,s+=e*F,u+=e*I,c+=e*G,y+=e*Z,l+=e*q,w+=e*V,v+=e*X,p+=e*D,b+=e*j,g+=e*H,_+=e*J,A+=e*Q,e=t[1],h+=e*P,a+=e*N,f+=e*O,s+=e*C,u+=e*F,c+=e*I,y+=e*G,l+=e*Z,w+=e*q,v+=e*V,p+=e*X,b+=e*D,g+=e*j,_+=e*H,A+=e*J,U+=e*Q,e=t[2],a+=e*P,f+=e*N,s+=e*O,u+=e*C,c+=e*F,y+=e*I,l+=e*G,w+=e*Z,v+=e*q,p+=e*V,b+=e*X,g+=e*D,_+=e*j,A+=e*H,U+=e*J,d+=e*Q,e=t[3],f+=e*P,s+=e*N,u+=e*O,c+=e*C,y+=e*F,l+=e*I,w+=e*G,v+=e*Z,p+=e*q,b+=e*V,g+=e*X,_+=e*D,A+=e*j,U+=e*H,d+=e*J,E+=e*Q,e=t[4],s+=e*P,u+=e*N,c+=e*O,y+=e*C,l+=e*F,w+=e*I,v+=e*G,p+=e*Z,b+=e*q,g+=e*V,_+=e*X,A+=e*D,U+=e*j,d+=e*H,E+=e*J,x+=e*Q,e=t[5],u+=e*P,c+=e*N,y+=e*O,l+=e*C,w+=e*F,v+=e*I,p+=e*G,b+=e*Z,g+=e*q,_+=e*V,A+=e*X,U+=e*D,d+=e*j,E+=e*H,x+=e*J,M+=e*Q,e=t[6],c+=e*P,y+=e*N,l+=e*O,w+=e*C,v+=e*F,p+=e*I,b+=e*G,g+=e*Z,_+=e*q,A+=e*V,U+=e*X,d+=e*D,E+=e*j,x+=e*H,M+=e*J,m+=e*Q,e=t[7],y+=e*P,l+=e*N,w+=e*O,v+=e*C,p+=e*F,b+=e*I,g+=e*G,_+=e*Z,A+=e*q,U+=e*V,d+=e*X,E+=e*D,x+=e*j,M+=e*H,m+=e*J,B+=e*Q,e=t[8],l+=e*P,w+=e*N,v+=e*O,p+=e*C,b+=e*F,g+=e*I,_+=e*G,A+=e*Z,U+=e*q,d+=e*V,E+=e*X,x+=e*D,M+=e*j,m+=e*H,B+=e*J,S+=e*Q,e=t[9],w+=e*P,v+=e*N,p+=e*O,b+=e*C,g+=e*F,_+=e*I,A+=e*G,U+=e*Z,d+=e*q,E+=e*V,x+=e*X,M+=e*D,m+=e*j,B+=e*H,S+=e*J,K+=e*Q,e=t[10],v+=e*P,p+=e*N,b+=e*O,g+=e*C,_+=e*F,A+=e*I,U+=e*G,d+=e*Z,E+=e*q,x+=e*V,M+=e*X,m+=e*D,B+=e*j,S+=e*H,K+=e*J,Y+=e*Q,e=t[11],p+=e*P,b+=e*N,g+=e*O,_+=e*C,A+=e*F,U+=e*I,d+=e*G,E+=e*Z,x+=e*q,M+=e*V,m+=e*X,B+=e*D;S+=e*j;K+=e*H,Y+=e*J,k+=e*Q,e=t[12],b+=e*P,g+=e*N,_+=e*O,A+=e*C,U+=e*F,d+=e*I,E+=e*G,x+=e*Z,M+=e*q,m+=e*V,B+=e*X,S+=e*D,K+=e*j,Y+=e*H,k+=e*J,T+=e*Q,e=t[13],g+=e*P,_+=e*N,A+=e*O,U+=e*C,d+=e*F,E+=e*I,x+=e*G,M+=e*Z,m+=e*q,B+=e*V,S+=e*X,K+=e*D,Y+=e*j,k+=e*H,T+=e*J,L+=e*Q,e=t[14],_+=e*P,A+=e*N,U+=e*O,d+=e*C,E+=e*F,x+=e*I,M+=e*G,m+=e*Z,B+=e*q,S+=e*V,K+=e*X,Y+=e*D,k+=e*j,T+=e*H,L+=e*J,z+=e*Q,e=t[15],A+=e*P,U+=e*N,d+=e*O,E+=e*C,x+=e*F,M+=e*I,m+=e*G,B+=e*Z,S+=e*q,K+=e*V,Y+=e*X,k+=e*D,T+=e*j,L+=e*H,z+=e*J,R+=e*Q,i+=38*U,h+=38*d,a+=38*E,f+=38*x,s+=38*M,u+=38*m,c+=38*B,y+=38*S,l+=38*K,w+=38*Y,v+=38*k,p+=38*T,b+=38*L,g+=38*z,_+=38*R,o=1,e=i+o+65535,o=Math.floor(e/65536),i=e-65536*o,e=h+o+65535,o=Math.floor(e/65536),h=e-65536*o,e=a+o+65535,o=Math.floor(e/65536),a=e-65536*o,e=f+o+65535,o=Math.floor(e/65536),f=e-65536*o,e=s+o+65535,o=Math.floor(e/65536),s=e-65536*o,e=u+o+65535,o=Math.floor(e/65536),u=e-65536*o,e=c+o+65535,o=Math.floor(e/65536),c=e-65536*o,e=y+o+65535,o=Math.floor(e/65536),y=e-65536*o,e=l+o+65535,o=Math.floor(e/65536),l=e-65536*o,e=w+o+65535,o=Math.floor(e/65536),w=e-65536*o,e=v+o+65535,o=Math.floor(e/65536),v=e-65536*o,e=p+o+65535,o=Math.floor(e/65536),p=e-65536*o,e=b+o+65535,o=Math.floor(e/65536),b=e-65536*o,e=g+o+65535,o=Math.floor(e/65536),g=e-65536*o,e=_+o+65535,o=Math.floor(e/65536),_=e-65536*o,e=A+o+65535,o=Math.floor(e/65536),A=e-65536*o,i+=o-1+37*(o-1),o=1,e=i+o+65535,o=Math.floor(e/65536),i=e-65536*o,e=h+o+65535,o=Math.floor(e/65536),h=e-65536*o,e=a+o+65535,o=Math.floor(e/65536),a=e-65536*o,e=f+o+65535,o=Math.floor(e/65536),f=e-65536*o,e=s+o+65535,o=Math.floor(e/65536),s=e-65536*o,e=u+o+65535,o=Math.floor(e/65536),u=e-65536*o,e=c+o+65535,o=Math.floor(e/65536),c=e-65536*o,e=y+o+65535,o=Math.floor(e/65536),y=e-65536*o,e=l+o+65535,o=Math.floor(e/65536),l=e-65536*o,e=w+o+65535,o=Math.floor(e/65536),w=e-65536*o,e=v+o+65535,o=Math.floor(e/65536),v=e-65536*o,e=p+o+65535,o=Math.floor(e/65536),p=e-65536*o,e=b+o+65535,o=Math.floor(e/65536),b=e-65536*o,e=g+o+65535,o=Math.floor(e/65536),g=e-65536*o,e=_+o+65535,o=Math.floor(e/65536),_=e-65536*o,e=A+o+65535,o=Math.floor(e/65536),A=e-65536*o,i+=o-1+37*(o-1),r[0]=i,r[1]=h,r[2]=a,r[3]=f,r[4]=s,r[5]=u,r[6]=c,r[7]=y,r[8]=l,r[9]=w,r[10]=v,r[11]=p,r[12]=b,r[13]=g;r[14]=_;r[15]=A}function B(r,t){m(r,t,t)}function S(r,t){var n,e=$();for(n=0;n<16;n++)e[n]=t[n];for(n=253;n>=0;n--)B(e,e),2!==n&&4!==n&&m(e,e,t);for(n=0;n<16;n++)r[n]=e[n]}function K(r,t){var n,e=$();for(n=0;n<16;n++)e[n]=t[n];for(n=250;n>=0;n--)B(e,e),1!==n&&m(e,e,t);for(n=0;n<16;n++)r[n]=e[n]}function Y(r,t,n){var e,o,i=new Uint8Array(32),h=new Float64Array(80),a=$(),f=$(),s=$(),u=$(),c=$(),y=$();for(o=0;o<31;o++)i[o]=t[o];for(i[31]=127&t[31]|64,i[0]&=248,E(h,n),o=0;o<16;o++)f[o]=h[o],u[o]=a[o]=s[o]=0;for(a[0]=u[0]=1,o=254;o>=0;--o)e=i[o>>>3]>>>(7&o)&1,_(a,f,e),_(s,u,e),x(c,a,s),M(a,a,s),x(s,f,u),M(f,f,u),B(u,c),B(y,a),m(a,s,a),m(s,f,c),x(c,a,s),M(a,a,s),B(f,a),M(s,u,y),m(a,s,ir),x(a,a,u),m(s,s,a),m(a,u,y),m(u,f,h),B(f,c),_(a,f,e),_(s,u,e);for(o=0;o<16;o++)h[o+16]=a[o],h[o+32]=s[o],h[o+48]=f[o],h[o+64]=u[o];var l=h.subarray(32),w=h.subarray(16);return S(l,l),m(w,w,l),A(r,w),0}function k(r,t){return Y(r,t,nr)}function T(r,t){return rr(t,32),k(r,t)}function L(r,t,n){var e=new Uint8Array(32);return Y(e,n,t),f(r,tr,e,cr)}function z(r,t,n,e,o,i){var h=new Uint8Array(32);return L(h,o,i),lr(r,t,n,e,h)}function R(r,t,n,e,o,i){var h=new Uint8Array(32);return L(h,o,i),wr(r,t,n,e,h)}function P(r,t,n,e){for(var o,i,h,a,f,s,u,c,y,l,w,v,p,b,g,_,A,U,d,E,x,M,m,B,S,K,Y=new Int32Array(16),k=new Int32Array(16),T=r[0],L=r[1],z=r[2],R=r[3],P=r[4],N=r[5],O=r[6],C=r[7],F=t[0],I=t[1],G=t[2],Z=t[3],q=t[4],V=t[5],X=t[6],D=t[7],j=0;e>=128;){for(d=0;d<16;d++)E=8*d+j,Y[d]=n[E+0]<<24|n[E+1]<<16|n[E+2]<<8|n[E+3],k[d]=n[E+4]<<24|n[E+5]<<16|n[E+6]<<8|n[E+7];for(d=0;d<80;d++)if(o=T,i=L,h=z,a=R,f=P,s=N,u=O,c=C,y=F,l=I,w=G,v=Z,p=q,b=V,g=X,_=D,x=C,M=D,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=(P>>>14|q<<18)^(P>>>18|q<<14)^(q>>>9|P<<23),M=(q>>>14|P<<18)^(q>>>18|P<<14)^(P>>>9|q<<23),m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,x=P&N^~P&O,M=q&V^~q&X,m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,x=vr[2*d],M=vr[2*d+1],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,x=Y[d%16],M=k[d%16],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,A=65535&S|K<<16,U=65535&m|B<<16,x=A,M=U,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=(T>>>28|F<<4)^(F>>>2|T<<30)^(F>>>7|T<<25),M=(F>>>28|T<<4)^(T>>>2|F<<30)^(T>>>7|F<<25),m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,x=T&L^T&z^L&z,M=F&I^F&G^I&G,m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,c=65535&S|K<<16,_=65535&m|B<<16,x=a,M=v,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=A,M=U,m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,a=65535&S|K<<16,v=65535&m|B<<16,L=o,z=i,R=h,P=a,N=f,O=s,C=u,T=c,I=y,G=l,Z=w,q=v,V=p,X=b,D=g,F=_,d%16===15)for(E=0;E<16;E++)x=Y[E],M=k[E],m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=Y[(E+9)%16],M=k[(E+9)%16],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,A=Y[(E+1)%16],U=k[(E+1)%16],x=(A>>>1|U<<31)^(A>>>8|U<<24)^A>>>7,M=(U>>>1|A<<31)^(U>>>8|A<<24)^(U>>>7|A<<25),m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,A=Y[(E+14)%16],U=k[(E+14)%16],x=(A>>>19|U<<13)^(U>>>29|A<<3)^A>>>6,M=(U>>>19|A<<13)^(A>>>29|U<<3)^(U>>>6|A<<26),m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,Y[E]=65535&S|K<<16,k[E]=65535&m|B<<16;x=T,M=F,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[0],M=t[0],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[0]=T=65535&S|K<<16,t[0]=F=65535&m|B<<16,x=L,M=I,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[1],M=t[1],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[1]=L=65535&S|K<<16,t[1]=I=65535&m|B<<16,x=z,M=G,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[2],M=t[2],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[2]=z=65535&S|K<<16,t[2]=G=65535&m|B<<16,x=R,M=Z,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[3],M=t[3],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[3]=R=65535&S|K<<16,t[3]=Z=65535&m|B<<16,x=P,M=q,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[4],M=t[4],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[4]=P=65535&S|K<<16,t[4]=q=65535&m|B<<16,x=N,M=V,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[5],M=t[5],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[5]=N=65535&S|K<<16,t[5]=V=65535&m|B<<16,x=O,M=X,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[6],M=t[6],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[6]=O=65535&S|K<<16,t[6]=X=65535&m|B<<16,x=C,M=D,m=65535&M,B=M>>>16,S=65535&x,K=x>>>16,x=r[7],M=t[7],m+=65535&M,B+=M>>>16,S+=65535&x,K+=x>>>16,B+=m>>>16,S+=B>>>16,K+=S>>>16,r[7]=C=65535&S|K<<16,t[7]=D=65535&m|B<<16,j+=128,e-=128}return e}function N(r,n,e){var o,i=new Int32Array(8),h=new Int32Array(8),a=new Uint8Array(256),f=e;for(i[0]=1779033703,i[1]=3144134277,i[2]=1013904242,i[3]=2773480762,i[4]=1359893119,i[5]=2600822924,i[6]=528734635,i[7]=1541459225,h[0]=4089235720,h[1]=2227873595,h[2]=4271175723,h[3]=1595750129,h[4]=2917565137,h[5]=725511199,h[6]=4215389547,h[7]=327033209,P(i,h,n,e),e%=128,o=0;o<e;o++)a[o]=n[f-e+o];for(a[e]=128,e=256-128*(e<112?1:0),a[e-9]=0,t(a,e-8,f/536870912|0,f<<3),P(i,h,a,e),o=0;o<8;o++)t(r,8*o,i[o],h[o]);return 0}function O(r,t){var n=$(),e=$(),o=$(),i=$(),h=$(),a=$(),f=$(),s=$(),u=$();M(n,r[1],r[0]),M(u,t[1],t[0]),m(n,n,u),x(e,r[0],r[1]),x(u,t[0],t[1]),m(e,e,u),m(o,r[3],t[3]),m(o,o,ar),m(i,r[2],t[2]),x(i,i,i),M(h,e,n),M(a,i,o),x(f,i,o),x(s,e,n),m(r[0],h,a),m(r[1],s,f),m(r[2],f,a),m(r[3],h,s)}function C(r,t,n){var e;for(e=0;e<4;e++)_(r[e],t[e],n)}function F(r,t){var n=$(),e=$(),o=$();S(o,t[2]),m(n,t[0],o),m(e,t[1],o),A(r,e),r[31]^=d(n)<<7}function I(r,t,n){var e,o;for(b(r[0],er),b(r[1],or),b(r[2],or),b(r[3],er),o=255;o>=0;--o)e=n[o/8|0]>>(7&o)&1,C(r,t,e),O(t,r),O(r,r),C(r,t,e)}function G(r,t){var n=[$(),$(),$(),$()];b(n[0],fr),b(n[1],sr),b(n[2],or),m(n[3],fr,sr),I(r,n,t)}function Z(r,t,n){var e,o=new Uint8Array(64),i=[$(),$(),$(),$()];for(n||rr(t,32),N(o,t,32),o[0]&=248,o[31]&=127,o[31]|=64,G(i,o),F(r,i),e=0;e<32;e++)t[e+32]=r[e];return 0}function q(r,t){var n,e,o,i;for(e=63;e>=32;--e){for(n=0,o=e-32,i=e-12;o<i;++o)t[o]+=n-16*t[e]*pr[o-(e-32)],n=t[o]+128>>8,t[o]-=256*n;t[o]+=n,t[e]=0}for(n=0,o=0;o<32;o++)t[o]+=n-(t[31]>>4)*pr[o],n=t[o]>>8,t[o]&=255;for(o=0;o<32;o++)t[o]-=n*pr[o];for(e=0;e<32;e++)t[e+1]+=t[e]>>8,r[e]=255&t[e]}function V(r){var t,n=new Float64Array(64);for(t=0;t<64;t++)n[t]=r[t];for(t=0;t<64;t++)r[t]=0;q(r,n)}function X(r,t,n,e){var o,i,h=new Uint8Array(64),a=new Uint8Array(64),f=new Uint8Array(64),s=new Float64Array(64),u=[$(),$(),$(),$()];N(h,e,32),h[0]&=248,h[31]&=127,h[31]|=64;var c=n+64;for(o=0;o<n;o++)r[64+o]=t[o];for(o=0;o<32;o++)r[32+o]=h[32+o];for(N(f,r.subarray(32),n+32),V(f),G(u,f),F(r,u),o=32;o<64;o++)r[o]=e[o];for(N(a,r,n+64),V(a),o=0;o<64;o++)s[o]=0;for(o=0;o<32;o++)s[o]=f[o];for(o=0;o<32;o++)for(i=0;i<32;i++)s[o+i]+=a[o]*h[i];return q(r.subarray(32),s),c}function D(r,t){var n=$(),e=$(),o=$(),i=$(),h=$(),a=$(),f=$();return b(r[2],or),E(r[1],t),B(o,r[1]),m(i,o,hr),M(o,o,r[2]),x(i,r[2],i),B(h,i),B(a,h),m(f,a,h),m(n,f,o),m(n,n,i),K(n,n),m(n,n,o),m(n,n,i),m(n,n,i),m(r[0],n,i),B(e,r[0]),m(e,e,i),U(e,o)&&m(r[0],r[0],ur),B(e,r[0]),m(e,e,i),U(e,o)?-1:(d(r[0])===t[31]>>7&&M(r[0],er,r[0]),m(r[3],r[0],r[1]),0)}function j(r,t,n,e){var i,h,a=new Uint8Array(32),f=new Uint8Array(64),s=[$(),$(),$(),$()],u=[$(),$(),$(),$()];if(h=-1,n<64)return-1;if(D(u,e))return-1;for(i=0;i<n;i++)r[i]=t[i];for(i=0;i<32;i++)r[i+32]=e[i];if(N(f,r,n),V(f),I(s,u,f),G(u,t.subarray(32)),O(s,u),F(a,s),n-=64,o(t,0,a,0)){for(i=0;i<n;i++)r[i]=0;return-1}for(i=0;i<n;i++)r[i]=t[i+64];return h=n}function H(r,t){if(r.length!==br)throw new Error("bad key size");if(t.length!==gr)throw new Error("bad nonce size")}function J(r,t){if(r.length!==Er)throw new Error("bad public key size");if(t.length!==xr)throw new Error("bad secret key size")}function Q(){for(var r=0;r<arguments.length;r++)if(!(arguments[r]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function W(r){for(var t=0;t<r.length;t++)r[t]=0}var $=function(r){var t,n=new Float64Array(16);if(r)for(t=0;t<r.length;t++)n[t]=r[t];return n},rr=function(){throw new Error("no PRNG")},tr=new Uint8Array(16),nr=new Uint8Array(32);nr[0]=9;var er=$(),or=$([1]),ir=$([56129,1]),hr=$([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),ar=$([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),fr=$([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),sr=$([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ur=$([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]),cr=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]),yr=function(r){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var t,n,e,o,i,h,a,f;t=255&r[0]|(255&r[1])<<8,this.r[0]=8191&t,n=255&r[2]|(255&r[3])<<8,this.r[1]=8191&(t>>>13|n<<3),e=255&r[4]|(255&r[5])<<8,this.r[2]=7939&(n>>>10|e<<6),o=255&r[6]|(255&r[7])<<8,this.r[3]=8191&(e>>>7|o<<9),i=255&r[8]|(255&r[9])<<8,this.r[4]=255&(o>>>4|i<<12),this.r[5]=i>>>1&8190,h=255&r[10]|(255&r[11])<<8,this.r[6]=8191&(i>>>14|h<<2),a=255&r[12]|(255&r[13])<<8,this.r[7]=8065&(h>>>11|a<<5),f=255&r[14]|(255&r[15])<<8,this.r[8]=8191&(a>>>8|f<<8),this.r[9]=f>>>5&127,this.pad[0]=255&r[16]|(255&r[17])<<8,this.pad[1]=255&r[18]|(255&r[19])<<8,this.pad[2]=255&r[20]|(255&r[21])<<8,this.pad[3]=255&r[22]|(255&r[23])<<8,this.pad[4]=255&r[24]|(255&r[25])<<8,this.pad[5]=255&r[26]|(255&r[27])<<8,this.pad[6]=255&r[28]|(255&r[29])<<8,this.pad[7]=255&r[30]|(255&r[31])<<8};yr.prototype.blocks=function(r,t,n){for(var e,o,i,h,a,f,s,u,c,y,l,w,v,p,b,g,_,A,U,d=this.fin?0:2048,E=this.h[0],x=this.h[1],M=this.h[2],m=this.h[3],B=this.h[4],S=this.h[5],K=this.h[6],Y=this.h[7],k=this.h[8],T=this.h[9],L=this.r[0],z=this.r[1],R=this.r[2],P=this.r[3],N=this.r[4],O=this.r[5],C=this.r[6],F=this.r[7],I=this.r[8],G=this.r[9];n>=16;)e=255&r[t+0]|(255&r[t+1])<<8,E+=8191&e,o=255&r[t+2]|(255&r[t+3])<<8,x+=8191&(e>>>13|o<<3),i=255&r[t+4]|(255&r[t+5])<<8,M+=8191&(o>>>10|i<<6),h=255&r[t+6]|(255&r[t+7])<<8,m+=8191&(i>>>7|h<<9),a=255&r[t+8]|(255&r[t+9])<<8,B+=8191&(h>>>4|a<<12),S+=a>>>1&8191,f=255&r[t+10]|(255&r[t+11])<<8,K+=8191&(a>>>14|f<<2),s=255&r[t+12]|(255&r[t+13])<<8,Y+=8191&(f>>>11|s<<5),u=255&r[t+14]|(255&r[t+15])<<8,k+=8191&(s>>>8|u<<8),T+=u>>>5|d,c=0,y=c,y+=E*L,y+=x*(5*G),y+=M*(5*I),y+=m*(5*F),y+=B*(5*C),c=y>>>13,y&=8191,y+=S*(5*O),y+=K*(5*N),y+=Y*(5*P),y+=k*(5*R),y+=T*(5*z),c+=y>>>13,y&=8191,l=c,l+=E*z,l+=x*L,l+=M*(5*G),l+=m*(5*I),l+=B*(5*F),c=l>>>13,l&=8191,l+=S*(5*C),l+=K*(5*O),l+=Y*(5*N),l+=k*(5*P),l+=T*(5*R),c+=l>>>13,l&=8191,w=c,w+=E*R,w+=x*z,w+=M*L,w+=m*(5*G),w+=B*(5*I),c=w>>>13,w&=8191,w+=S*(5*F),w+=K*(5*C),w+=Y*(5*O),w+=k*(5*N),w+=T*(5*P),c+=w>>>13,w&=8191,v=c,v+=E*P,v+=x*R,v+=M*z,v+=m*L,v+=B*(5*G),c=v>>>13,v&=8191,v+=S*(5*I),v+=K*(5*F),v+=Y*(5*C),v+=k*(5*O),v+=T*(5*N),c+=v>>>13,v&=8191,p=c,p+=E*N,p+=x*P,p+=M*R,p+=m*z,p+=B*L,c=p>>>13,p&=8191,p+=S*(5*G),p+=K*(5*I),p+=Y*(5*F),p+=k*(5*C),p+=T*(5*O),c+=p>>>13,p&=8191,b=c,b+=E*O,b+=x*N,b+=M*P,b+=m*R,b+=B*z,c=b>>>13,b&=8191,b+=S*L,b+=K*(5*G),b+=Y*(5*I),b+=k*(5*F),b+=T*(5*C),c+=b>>>13,b&=8191,g=c,g+=E*C,g+=x*O,g+=M*N,g+=m*P,g+=B*R,c=g>>>13,g&=8191,g+=S*z,g+=K*L,g+=Y*(5*G),g+=k*(5*I),g+=T*(5*F),c+=g>>>13,g&=8191,_=c,_+=E*F,_+=x*C,_+=M*O,_+=m*N,_+=B*P,c=_>>>13,_&=8191,_+=S*R,_+=K*z,_+=Y*L,_+=k*(5*G),_+=T*(5*I),c+=_>>>13,_&=8191,A=c,A+=E*I,A+=x*F,A+=M*C,A+=m*O,A+=B*N,c=A>>>13,A&=8191,A+=S*P,A+=K*R,A+=Y*z,A+=k*L,A+=T*(5*G),c+=A>>>13,A&=8191,U=c,U+=E*G,U+=x*I,U+=M*F,U+=m*C,U+=B*O,c=U>>>13,U&=8191,U+=S*N,U+=K*P,U+=Y*R,U+=k*z,U+=T*L,c+=U>>>13,U&=8191,c=(c<<2)+c|0,c=c+y|0,y=8191&c,c>>>=13,l+=c,E=y,x=l,M=w,m=v,B=p,S=b,K=g,Y=_,k=A,T=U,t+=16,n-=16;this.h[0]=E,this.h[1]=x,this.h[2]=M,this.h[3]=m,this.h[4]=B,this.h[5]=S,this.h[6]=K,this.h[7]=Y,this.h[8]=k,this.h[9]=T},yr.prototype.finish=function(r,t){var n,e,o,i,h=new Uint16Array(10);if(this.leftover){for(i=this.leftover,this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(n=this.h[1]>>>13,this.h[1]&=8191,i=2;i<10;i++)this.h[i]+=n,n=this.h[i]>>>13,this.h[i]&=8191;for(this.h[0]+=5*n,n=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=n,n=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=n,h[0]=this.h[0]+5,n=h[0]>>>13,h[0]&=8191,i=1;i<10;i++)h[i]=this.h[i]+n,n=h[i]>>>13,h[i]&=8191;for(h[9]-=8192,e=(1^n)-1,i=0;i<10;i++)h[i]&=e;for(e=~e,i=0;i<10;i++)this.h[i]=this.h[i]&e|h[i];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),o=this.h[0]+this.pad[0],this.h[0]=65535&o,i=1;i<8;i++)o=(this.h[i]+this.pad[i]|0)+(o>>>16)|0,this.h[i]=65535&o;r[t+0]=this.h[0]>>>0&255,r[t+1]=this.h[0]>>>8&255,r[t+2]=this.h[1]>>>0&255,r[t+3]=this.h[1]>>>8&255,r[t+4]=this.h[2]>>>0&255,r[t+5]=this.h[2]>>>8&255,r[t+6]=this.h[3]>>>0&255,r[t+7]=this.h[3]>>>8&255,r[t+8]=this.h[4]>>>0&255,r[t+9]=this.h[4]>>>8&255,r[t+10]=this.h[5]>>>0&255,r[t+11]=this.h[5]>>>8&255,r[t+12]=this.h[6]>>>0&255,r[t+13]=this.h[6]>>>8&255,r[t+14]=this.h[7]>>>0&255,r[t+15]=this.h[7]>>>8&255},yr.prototype.update=function(r,t,n){var e,o;if(this.leftover){for(o=16-this.leftover,o>n&&(o=n),e=0;e<o;e++)this.buffer[this.leftover+e]=r[t+e];if(n-=o,t+=o,this.leftover+=o,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(n>=16&&(o=n-n%16,this.blocks(r,t,o),t+=o,n-=o),n){for(e=0;e<n;e++)this.buffer[this.leftover+e]=r[t+e];this.leftover+=n}};var lr=v,wr=p,vr=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],pr=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),br=32,gr=24,_r=32,Ar=16,Ur=32,dr=32,Er=32,xr=32,Mr=32,mr=gr,Br=_r,Sr=Ar,Kr=64,Yr=32,kr=64,Tr=32,Lr=64;r.lowlevel={crypto_core_hsalsa20:f,crypto_stream_xor:y,crypto_stream:c,crypto_stream_salsa20_xor:s,crypto_stream_salsa20:u,crypto_onetimeauth:l,crypto_onetimeauth_verify:w,crypto_verify_16:e,crypto_verify_32:o,crypto_secretbox:v,crypto_secretbox_open:p,crypto_scalarmult:Y,crypto_scalarmult_base:k,crypto_box_beforenm:L,crypto_box_afternm:lr,crypto_box:z,crypto_box_open:R,crypto_box_keypair:T,crypto_hash:N,crypto_sign:X,crypto_sign_keypair:Z,crypto_sign_open:j,crypto_secretbox_KEYBYTES:br,crypto_secretbox_NONCEBYTES:gr,crypto_secretbox_ZEROBYTES:_r,crypto_secretbox_BOXZEROBYTES:Ar,crypto_scalarmult_BYTES:Ur,crypto_scalarmult_SCALARBYTES:dr,crypto_box_PUBLICKEYBYTES:Er,crypto_box_SECRETKEYBYTES:xr,crypto_box_BEFORENMBYTES:Mr,crypto_box_NONCEBYTES:mr,crypto_box_ZEROBYTES:Br,crypto_box_BOXZEROBYTES:Sr,crypto_sign_BYTES:Kr,crypto_sign_PUBLICKEYBYTES:Yr,crypto_sign_SECRETKEYBYTES:kr,crypto_sign_SEEDBYTES:Tr,crypto_hash_BYTES:Lr},r.randomBytes=function(r){var t=new Uint8Array(r);return rr(t,r),t},r.secretbox=function(r,t,n){Q(r,t,n),H(n,t);for(var e=new Uint8Array(_r+r.length),o=new Uint8Array(e.length),i=0;i<r.length;i++)e[i+_r]=r[i];return v(o,e,e.length,t,n),o.subarray(Ar)},r.secretbox.open=function(r,t,n){Q(r,t,n),H(n,t);for(var e=new Uint8Array(Ar+r.length),o=new Uint8Array(e.length),i=0;i<r.length;i++)e[i+Ar]=r[i];return e.length<32?null:0!==p(o,e,e.length,t,n)?null:o.subarray(_r)},r.secretbox.keyLength=br,r.secretbox.nonceLength=gr,r.secretbox.overheadLength=Ar,r.scalarMult=function(r,t){if(Q(r,t),r.length!==dr)throw new Error("bad n size");if(t.length!==Ur)throw new Error("bad p size");var n=new Uint8Array(Ur);return Y(n,r,t),n},r.scalarMult.base=function(r){if(Q(r),r.length!==dr)throw new Error("bad n size");var t=new Uint8Array(Ur);return k(t,r),t},r.scalarMult.scalarLength=dr,r.scalarMult.groupElementLength=Ur,r.box=function(t,n,e,o){var i=r.box.before(e,o);return r.secretbox(t,n,i)},r.box.before=function(r,t){Q(r,t),J(r,t);var n=new Uint8Array(Mr);return L(n,r,t),n},r.box.after=r.secretbox,r.box.open=function(t,n,e,o){var i=r.box.before(e,o);return r.secretbox.open(t,n,i)},r.box.open.after=r.secretbox.open,r.box.keyPair=function(){var r=new Uint8Array(Er),t=new Uint8Array(xr);return T(r,t),{publicKey:r,secretKey:t}},r.box.keyPair.fromSecretKey=function(r){if(Q(r),r.length!==xr)throw new Error("bad secret key size");var t=new Uint8Array(Er);return k(t,r),{publicKey:t,secretKey:new Uint8Array(r)}},r.box.publicKeyLength=Er,r.box.secretKeyLength=xr,r.box.sharedKeyLength=Mr,r.box.nonceLength=mr,r.box.overheadLength=r.secretbox.overheadLength,r.sign=function(r,t){if(Q(r,t),t.length!==kr)throw new Error("bad secret key size");var n=new Uint8Array(Kr+r.length);return X(n,r,r.length,t),n},r.sign.open=function(r,t){if(Q(r,t),t.length!==Yr)throw new Error("bad public key size");var n=new Uint8Array(r.length),e=j(n,r,r.length,t);if(e<0)return null;for(var o=new Uint8Array(e),i=0;i<o.length;i++)o[i]=n[i];return o},r.sign.detached=function(t,n){for(var e=r.sign(t,n),o=new Uint8Array(Kr),i=0;i<o.length;i++)o[i]=e[i];return o},r.sign.detached.verify=function(r,t,n){if(Q(r,t,n),t.length!==Kr)throw new Error("bad signature size");if(n.length!==Yr)throw new Error("bad public key size");var e,o=new Uint8Array(Kr+r.length),i=new Uint8Array(Kr+r.length);for(e=0;e<Kr;e++)o[e]=t[e];for(e=0;e<r.length;e++)o[e+Kr]=r[e];return j(i,o,o.length,n)>=0},r.sign.keyPair=function(){var r=new Uint8Array(Yr),t=new Uint8Array(kr);return Z(r,t),{publicKey:r,secretKey:t}},r.sign.keyPair.fromSecretKey=function(r){if(Q(r),r.length!==kr)throw new Error("bad secret key size");for(var t=new Uint8Array(Yr),n=0;n<t.length;n++)t[n]=r[32+n];return{publicKey:t,secretKey:new Uint8Array(r)}},r.sign.keyPair.fromSeed=function(r){if(Q(r),r.length!==Tr)throw new Error("bad seed size");for(var t=new Uint8Array(Yr),n=new Uint8Array(kr),e=0;e<32;e++)n[e]=r[e];return Z(t,n,!0),{publicKey:t,secretKey:n}},r.sign.publicKeyLength=Yr,r.sign.secretKeyLength=kr,r.sign.seedLength=Tr,r.sign.signatureLength=Kr,r.hash=function(r){Q(r);var t=new Uint8Array(Lr);return N(t,r,r.length),t},r.hash.hashLength=Lr,r.verify=function(r,t){return Q(r,t),0!==r.length&&0!==t.length&&(r.length===t.length&&0===n(r,0,t,0,r.length))},r.setPRNG=function(r){rr=r},function(){var t="undefined"!=typeof self?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){var n=65536;r.setPRNG(function(r,e){var o,i=new Uint8Array(e);for(o=0;o<e;o+=n)t.getRandomValues(i.subarray(o,o+Math.min(e-o,n)));for(o=0;o<e;o++)r[o]=i[o];W(i)})}else"undefined"!=typeof require&&(t=require("crypto"),
t&&t.randomBytes&&r.setPRNG(function(r,n){var e,o=t.randomBytes(n);for(e=0;e<n;e++)r[e]=o[e];W(o)}))}()}("undefined"!=typeof module&&module.exports?module.exports:self.nacl=self.nacl||{});!function(e,n){"use strict";"undefined"!=typeof module&&module.exports?module.exports=n():e.nacl?e.nacl.util=n():(e.nacl={},e.nacl.util=n())}(this,function(){"use strict";function e(e){if(!/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e))throw new TypeError("invalid encoding")}var n={};return n.decodeUTF8=function(e){if("string"!=typeof e)throw new TypeError("expected string");var n,r=unescape(encodeURIComponent(e)),t=new Uint8Array(r.length);for(n=0;n<r.length;n++)t[n]=r.charCodeAt(n);return t},n.encodeUTF8=function(e){var n,r=[];for(n=0;n<e.length;n++)r.push(String.fromCharCode(e[n]));return decodeURIComponent(escape(r.join("")))},"undefined"==typeof atob?"undefined"!=typeof Buffer.from?(n.encodeBase64=function(e){return Buffer.from(e).toString("base64")},n.decodeBase64=function(n){return e(n),new Uint8Array(Array.prototype.slice.call(Buffer.from(n,"base64"),0))}):(n.encodeBase64=function(e){return new Buffer(e).toString("base64")},n.decodeBase64=function(n){return e(n),new Uint8Array(Array.prototype.slice.call(new Buffer(n,"base64"),0))}):(n.encodeBase64=function(e){var n,r=[],t=e.length;for(n=0;n<t;n++)r.push(String.fromCharCode(e[n]));return btoa(r.join(""))},n.decodeBase64=function(n){e(n);var r,t=atob(n),o=new Uint8Array(t.length);for(r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return o}),n});"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
sjcl.cipher.aes=function(a){this._tables[0][0][0]||this._precompute();var b,c,d,e,f=this._tables[0][4],g=this._tables[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this._key=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>
16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};
sjcl.cipher.aes.prototype={encrypt:function(a){return this._crypt(a,0)},decrypt:function(a){return this._crypt(a,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var a=this._tables[0],b=this._tables[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,m,n,p;for(e=0;0x100>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(n=g^g<<1^g<<2^g<<3^g<<4,n=n>>8^n&255^99,c[f]=n,d[n]=f,m=h[e=h[l=h[f]]],p=0x1010101*m^0x10001*e^0x101*l^0x1010100*f,m=0x101*h[n]^0x1010100*n,e=0;4>e;e++)a[e][f]=m=
m<<24^m>>>8,b[e][n]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)},_crypt:function(a,b){if(4!==a.length)throw new sjcl.exception.invalid("invalid aes block size");var c=this._key[b],d=a[0]^c[0],e=a[b?3:1]^c[1],f=a[2]^c[2],g=a[b?1:3]^c[3],h,k,l,m=c.length/4-2,n,p=4,r=[0,0,0,0];h=this._tables[b];var q=h[0],t=h[1],u=h[2],v=h[3],w=h[4];for(n=0;n<m;n++)h=q[d>>>24]^t[e>>16&255]^u[f>>8&255]^v[g&255]^c[p],k=q[e>>>24]^t[f>>16&255]^u[g>>8&255]^v[d&255]^c[p+1],l=q[f>>>24]^t[g>>16&255]^
u[d>>8&255]^v[e&255]^c[p+2],g=q[g>>>24]^t[d>>16&255]^u[e>>8&255]^v[f&255]^c[p+3],p+=4,d=h,e=k,f=l;for(n=0;4>n;n++)r[b?3&-n:n]=w[d>>>24]<<24^w[e>>16&255]<<16^w[f>>8&255]<<8^w[g&255]^c[p++],h=d,d=e,e=f,f=g,g=h;return r}};
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray._shiftRight(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray._shiftRight(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=
a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+0x10000000000*a},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return!1;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^
b[d];return 0===c},_shiftRight:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},_xor4:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&0xff00|(c&0xff00)<<8|c<<24;return a}};
sjcl.codec.bytes={fromBits:function(a){var b=[],c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b.push(e>>>24),e<<=8;return b},toBits:function(a){var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a[c],3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};
sjcl.codec.base32={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",_hexChars:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32._chars,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32._hexChars);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\s|=/g,"").toUpperCase();
var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32._chars,l=0,m,n="base32";b&&(k=sjcl.codec.base32._hexChars,n="base32hex");for(g=0;g<a.length;g++){m=k.indexOf(a.charAt(g));if(0>m){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn't "+n+"!");}h>e?(h-=e,f.push(l^m>>>h),l=m<<c-h):(h+=d,l^=m<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};
sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};
sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64._chars,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64._chars,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));
if(0>h)throw new sjcl.exception.invalid("this isn't base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha1=function(a){a?(this._h=a._h.slice(0),this._buffer=a._buffer.slice(0),this._length=a._length):this.reset()};sjcl.hash.sha1.hash=function(a){return(new sjcl.hash.sha1).update(a).finalize()};
sjcl.hash.sha1.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this._buffer=sjcl.bitArray.concat(this._buffer,a);b=this._length;a=this._length=b+sjcl.bitArray.bitLength(a);if(0x1fffffffffffff<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=this.blockSize+
b-(this.blockSize+b&this.blockSize-1);b<=a;b+=this.blockSize)this._block(d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=this.blockSize+b-(this.blockSize+b&this.blockSize-1);b<=a;b+=this.blockSize)this._block(c.splice(0,16));return this},finalize:function(){var a,b=this._buffer,c=this._h,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this._length/0x100000000));for(b.push(this._length|0);b.length;)this._block(b.splice(0,16));
this.reset();return c},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(a,b,c,d){if(19>=a)return b&c|~b&d;if(39>=a)return b^c^d;if(59>=a)return b&c|b&d|c&d;if(79>=a)return b^c^d},_S:function(a,b){return b<<a|b>>>32-a},_block:function(a){var b,c,d,e,f,g,h=this._h,k;if("undefined"!==typeof Uint32Array)for(k=Array(80),b=0;16>b;b++)k[b]=a[b];else k=a;c=h[0];d=h[1];e=h[2];f=h[3];g=h[4];for(a=0;79>=a;a++)16<=a&&(k[a]=this._S(1,
k[a-3]^k[a-8]^k[a-14]^k[a-16])),b=this._S(5,c)+this._f(a,d,e,f)+g+k[a]+this._key[Math.floor(a/20)]|0,g=f,f=e,e=this._S(30,d),d=c,c=b;h[0]=h[0]+c|0;h[1]=h[1]+d|0;h[2]=h[2]+e|0;h[3]=h[3]+f|0;h[4]=h[4]+g|0}};sjcl.hash.sha256=function(a){this._key[0]||this._precompute();a?(this._h=a._h.slice(0),this._buffer=a._buffer.slice(0),this._length=a._length):this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this._buffer=sjcl.bitArray.concat(this._buffer,a);b=this._length;a=this._length=b+sjcl.bitArray.bitLength(a);if(0x1fffffffffffff<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+
b&0x1ff);b<=a;b+=512)this._block(d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&0x1ff);b<=a;b+=512)this._block(c.splice(0,16));return this},finalize:function(){var a,b=this._buffer,c=this._h,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this._length/0x100000000));for(b.push(this._length|0);b.length;)this._block(b.splice(0,16));this.reset();return c},_init:[],_key:[],_precompute:function(){function a(a){return 0x100000000*
(a-Math.floor(a))|0}for(var b=0,c=2,d,e;64>b;c++){e=!0;for(d=2;d*d<=c;d++)if(0===c%d){e=!1;break}e&&(8>b&&(this._init[b]=a(Math.pow(c,.5))),this._key[b]=a(Math.pow(c,1/3)),b++)}},_block:function(a){var b,c,d,e=this._h,f=this._key,g=e[0],h=e[1],k=e[2],l=e[3],m=e[4],n=e[5],p=e[6],r=e[7];for(b=0;64>b;b++)16>b?c=a[b]:(c=a[b+1&15],d=a[b+14&15],c=a[b&15]=(c>>>7^c>>>18^c>>>3^c<<25^c<<14)+(d>>>17^d>>>19^d>>>10^d<<15^d<<13)+a[b&15]+a[b+9&15]|0),c=c+r+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(p^m&(n^p))+f[b],
r=p,p=n,n=m,m=l+c|0,l=k,k=h,h=g,g=c+(h&k^l&(h^k))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0;e[0]=e[0]+g|0;e[1]=e[1]+h|0;e[2]=e[2]+k|0;e[3]=e[3]+l|0;e[4]=e[4]+m|0;e[5]=e[5]+n|0;e[6]=e[6]+p|0;e[7]=e[7]+r|0}};
sjcl.mode.ccm={name:"ccm",_progressListeners:[],listenProgress:function(a){sjcl.mode.ccm._progressListeners.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm._progressListeners.indexOf(a);-1<a&&sjcl.mode.ccm._progressListeners.splice(a,1)},_callProgressListener:function(a){var b=sjcl.mode.ccm._progressListeners.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");
for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm._computeTag(a,b,c,d,e,f);g=sjcl.mode.ccm._ctrMode(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm._ctrMode(a,k,c,l,e,b);
a=sjcl.mode.ccm._computeTag(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return k.data},_macAdditionalData:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h._xor4;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:0xffffffff>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));
return d},_computeTag:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g._xor4;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(0xffffffff<d.length||0xffffffff<b.length)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");c=sjcl.mode.ccm._macAdditionalData(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},_ctrMode:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h._xor4;var k=b.length,
l=h.bitLength(b),m=k/50,n=m;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>m&&(sjcl.mode.ccm._callProgressListener(g/k),m+=n),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2._times2,k=sjcl.bitArray,l=k._xor4,m=[0,0,0,0];c=h(a.encrypt(c));var n,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)n=b.slice(g,g+4),m=l(m,n),p=p.concat(l(c,a.encrypt(l(c,n)))),c=h(c);n=b.slice(g);b=k.bitLength(n);g=a.encrypt(l(c,[0,0,0,b]));n=k.clamp(l(n.concat([0,0,0]),g),b);m=l(m,l(n.concat([0,0,0]),g));m=a.encrypt(l(m,
l(c,h(c))));d.length&&(m=l(m,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(n,k.clamp(m,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2._times2,h=sjcl.bitArray,k=h._xor4,l=[0,0,0,0],m=g(a.encrypt(c)),n,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)n=k(m,a.decrypt(k(m,b.slice(c,c+4)))),l=k(l,n),q=q.concat(n),m=g(m);p=r-32*c;n=a.encrypt(k(m,[0,0,0,p]));n=k(n,
h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,n);l=a.encrypt(k(l,k(m,g(m))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return q.concat(h.clamp(n,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2._times2,e=sjcl.bitArray,f=e._xor4,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=
e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},_times2:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};
sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm._ctrMode(!0,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm._ctrMode(!1,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return a.data},_galoisMultiply:function(a,b){var c,d,e,f,
g,h=sjcl.bitArray._xor4;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-0x1f000000)}return e},_ghash:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=0xffffffff&c[d],b[1]^=0xffffffff&c[d+1],b[2]^=0xffffffff&c[d+2],b[3]^=0xffffffff&c[d+3],b=sjcl.mode.gcm._galoisMultiply(b,a);return b},_ctrMode:function(a,b,c,d,e,f){var g,h,k,l,m,n,p,r,q=sjcl.bitArray;
n=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm._ghash(g,[0,0,0,0],e),e=sjcl.mode.gcm._ghash(g,e,[0,0,Math.floor(h/0x100000000),h&0xffffffff]));h=sjcl.mode.gcm._ghash(g,[0,0,0,0],d);m=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm._ghash(g,h,c));for(l=0;l<n;l+=4)m[3]++,k=b.encrypt(m),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm._ghash(g,h,c));a=[Math.floor(r/0x100000000),
r&0xffffffff,Math.floor(p/0x100000000),p&0xffffffff];d=sjcl.mode.gcm._ghash(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this._hash=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this._baseHash=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this._baseHash[0].update(c[0]);this._baseHash[1].update(c[1]);this._resultHash=new b(this._baseHash[0])};
sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this._updated)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]);this._updated=!1};sjcl.misc.hmac.prototype.update=function(a){this._updated=!0;this._resultHash.update(a)};
sjcl.misc.hmac.prototype.digest=function(){var a=this._resultHash.finalize(),a=(new this._hash(this._baseHash[1])).update(a).finalize();this.reset();return a};
sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],m=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(m.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=m.clamp(l,d));return l};
sjcl.prng=function(a){this._pools=[new sjcl.hash.sha256];this._poolEntropy=[0];this._reseedCount=0;this._robins={};this._eventId=0;this._collectorIds={};this._nextReseed=this._poolStrength=this._strength=this._collectorIdNext=0;this._key=[0,0,0,0,0,0,0,0];this._counter=[0,0,0,0];this._cipher=void 0;this._defaultParanoia=a;this._collectorsStarted=!1;this._callbacks={progress:{},seeded:{}};this._NOT_READY=this._callbackI=0;this._READY=1;this._REQUIRES_RESEED=2;this._MAX_WORDS_PER_BURST=0x10000;this._PARANOIA_LEVELS=
[0,48,64,96,128,192,0x100,384,512,768,1024];this._MILLISECONDS_PER_RESEED=3E4;this._BITS_PER_RESEED=80};
sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this._NOT_READY)throw new sjcl.exception.notReady("generator isn't seeded");d&this._REQUIRES_RESEED&&this._reseedFromPools(!(d&this._READY));for(d=0;d<a;d+=4)0===(d+1)%this._MAX_WORDS_PER_BURST&&this._gate(),e=this._gen4words(),c.push(e[0],e[1],e[2],e[3]);this._gate();return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");
this._defaultParanoia=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this._robins[c],h=this.isReady(),k=0;d=this._collectorIds[c];void 0===d&&(d=this._collectorIds[c]=this._collectorIdNext++);void 0===g&&(g=this._robins[c]=0);this._robins[c]=(this._robins[c]+1)%this._pools.length;switch(typeof a){case "number":void 0===b&&(b=1);this._pools[g].update([d,this._eventId++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=
[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e>>>=1;this._pools[g].update([d,this._eventId++,2,b,f,a.length].concat(a))}break;case "string":void 0===b&&(b=a.length);this._pools[g].update([d,this._eventId++,3,b,f,a.length]);this._pools[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");
this._poolEntropy[g]+=b;this._poolStrength+=b;h===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(a){a=this._PARANOIA_LEVELS[void 0!==a?a:this._defaultParanoia];return this._strength&&this._strength>=a?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=a?this._REQUIRES_RESEED|
this._NOT_READY:this._NOT_READY},getProgress:function(a){a=this._PARANOIA_LEVELS[a?a:this._defaultParanoia];return this._strength>=a?1:this._poolStrength>a?1:this._poolStrength/a},startCollectors:function(){if(!this._collectorsStarted){this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)};
if(window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this._eventListener.loadTimeCollector),
document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector);else throw new sjcl.exception.bug("can't attach event");this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,
!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(a,b){this._callbacks[a][this._callbackI++]=
b},removeEventListener:function(a,b){var c,d,e=this._callbacks[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},_bind:function(a){var b=this;return function(){a.apply(b,arguments)}},_gen4words:function(){for(var a=0;4>a&&(this._counter[a]=this._counter[a]+1|0,!this._counter[a]);a++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(a){this._key=
sjcl.hash.sha256.hash(this._key.concat(a));this._cipher=new sjcl.cipher.aes(this._key);for(a=0;4>a&&(this._counter[a]=this._counter[a]+1|0,!this._counter[a]);a++);},_reseedFromPools:function(a){var b=[],c=0,d;this._nextReseed=b[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(d=0;16>d;d++)b.push(0x100000000*Math.random()|0);for(d=0;d<this._pools.length&&(b=b.concat(this._pools[d].finalize()),c+=this._poolEntropy[d],this._poolEntropy[d]=0,a||!(this._reseedCount&1<<d));d++);this._reseedCount>=
1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),this._poolEntropy.push(0));this._poolStrength-=c;c>this._strength&&(this._strength=c);this._reseedCount++;this._reseed(b)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");this._addCurrentTimeToEntropy(0)},_touchCollector:function(a){a=a.touches[0]||a.changedTouches[0];
this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(a){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?this.addEntropy(window.performance.now(),a,"loadtime"):this.addEntropy((new Date).valueOf(),a,"loadtime")},_accelerometerCollector:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||
a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");this._addCurrentTimeToEntropy(0)},_fireEvent:function(a,b){var c,d=sjcl.random._callbacks[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}};sjcl.random=new sjcl.prng(6);
(function(){try{var a,b,c,d;if(d="undefined"!==typeof module&&module.exports){var e;try{e=require("crypto")}catch(f){e=null}d=b=e}if(d&&b.randomBytes)a=b.randomBytes(128),a=new Uint32Array((new Uint8Array(a)).buffer),sjcl.random.addEntropy(a,1024,"crypto['randomBytes']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){c=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(c);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(c);
else return;sjcl.random.addEntropy(c,1024,"crypto['getRandomValues']")}}catch(f){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(f))}})();
sjcl.json={defaults:{v:1,iter:1E4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e._add({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e._add(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&0x100!==f.ks||2>
f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e._add(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&
sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e._encrypt.apply(e,arguments);return e.encode(f)},_decrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e._add(e._add(e._add({},e.defaults),b),c,!0);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||
!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&0x100!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);
f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e._add(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e._decrypt(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");
c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+sjcl.codec.base64.fromBits(a[b],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");
null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},_add:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},_subtract:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},
_filter:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc._pbkdf2Cache={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc._pbkdf2Cache,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};
"undefined"!==typeof module&&module.exports&&(module.exports=sjcl);"function"===typeof define&&define([],function(){return sjcl});
"use strict";var $jscomp={scope:{},getGlobal:function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.initSymbol=function(){$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol);$jscomp.initSymbol=function(){}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return"jscomp_symbol_"+a+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();if(a[$jscomp.global.Symbol.iterator])return a[$jscomp.global.Symbol.iterator]();if(!(a instanceof Array||"string"==typeof a||a instanceof String))throw new TypeError(a+" is not iterable");var c=0;return{next:function(){return c==a.length?{done:!0}:{done:!1,value:a[c++]}}}};$jscomp.arrayFromIterator=function(a){for(var c,b=[];!(c=a.next()).done;)b.push(c.value);return b};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.arrayFromArguments=function(a){for(var c=[],b=0;b<a.length;b++)c.push(a[b]);return c};
$jscomp.inherits=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;for(var d in c)if($jscomp.global.Object.defineProperties){var e=$jscomp.global.Object.getOwnPropertyDescriptor(c,d);void 0!==e&&$jscomp.global.Object.defineProperty(a,d,e)}else a[d]=c[d]};
var bigInt=function(a){function c(a,b,d,e){if("undefined"===typeof a)return c[0];if("undefined"!==typeof b){if(10!==+b||d){var g;g=d||"0123456789abcdefghijklmnopqrstuvwxyz";a=String(a);e||(a=a.toLowerCase(),g=g.toLowerCase());var f=a.length,h=Math.abs(b);d={};for(e=0;e<g.length;e++)d[g[e]]=e;for(e=0;e<f;e++)if(g=a[e],"-"!==g&&g in d&&d[g]>=h&&("1"!==g||1!==h))throw Error(g+" is not a valid digit in base "+b+".");b=m(b);f=[];for(e=(h="-"===a[0])?1:0;e<a.length;e++)if(g=a[e],g in d)f.push(m(d[g]));
else if("<"===g){g=e;do e++;while(">"!==a[e]&&e<a.length);f.push(m(a.slice(g+1,e)))}else throw Error(g+" is not a valid character");b=U(f,b,h)}else b=m(a);return b}return m(a)}function b(a,b){this.value=a;this.sign=b;this.isSmall=!1}function d(a){this.value=a;this.sign=0>a;this.isSmall=!0}function e(a){this.value=a}function f(a){return-9007199254740992<a&&9007199254740992>a}function h(a){return 1E7>a?[a]:1E14>a?[a%1E7,Math.floor(a/1E7)]:[a%1E7,Math.floor(a/1E7)%1E7,Math.floor(a/1E14)]}function g(a){l(a);
var b=a.length;if(4>b&&0>F(a,P))switch(b){case 0:return 0;case 1:return a[0];case 2:return a[0]+1E7*a[1];default:return a[0]+1E7*(a[1]+1E7*a[2])}return a}function l(a){for(var b=a.length;0===a[--b];);a.length=b+1}function k(a){for(var b=Array(a),c=-1;++c<a;)b[c]=0;return b}function n(a){return 0<a?Math.floor(a):Math.ceil(a)}function q(a,b){var c=a.length,d=b.length,e=Array(c),g=0,f,h;for(h=0;h<d;h++)f=a[h]+b[h]+g,g=1E7<=f?1:0,e[h]=f-1E7*g;for(;h<c;)f=a[h]+g,g=1E7===f?1:0,e[h++]=f-1E7*g;0<g&&e.push(g);
return e}function A(a,b){return a.length>=b.length?q(a,b):q(b,a)}function u(a,b){var c=a.length,d=Array(c),e,g;for(g=0;g<c;g++)e=a[g]-1E7+b,b=Math.floor(e/1E7),d[g]=e-1E7*b,b+=1;for(;0<b;)d[g++]=b%1E7,b=Math.floor(b/1E7);return d}function x(a,b){var c=a.length,d=b.length,e=Array(c),g=0,f,h;for(f=0;f<d;f++)h=a[f]-g-b[f],0>h?(h+=1E7,g=1):g=0,e[f]=h;for(f=d;f<c;f++){h=a[f]-g;if(0>h)h+=1E7;else{e[f++]=h;break}e[f]=h}for(;f<c;f++)e[f]=a[f];l(e);return e}function D(a,c,e){var f=a.length,h=Array(f);c=-c;
var l,k;for(l=0;l<f;l++)k=a[l]+c,c=Math.floor(k/1E7),k%=1E7,h[l]=0>k?k+1E7:k;h=g(h);return"number"===typeof h?(e&&(h=-h),new d(h)):new b(h,e)}function Q(a,b){var c=a.length,d=b.length,e=k(c+d),g,f,h,m;for(h=0;h<c;++h){m=a[h];for(var n=0;n<d;++n)g=b[n],g=m*g+e[h+n],f=Math.floor(g/1E7),e[h+n]=g-1E7*f,e[h+n+1]+=f}l(e);return e}function J(a,b){var c=a.length,d=Array(c),e=0,g,h;for(h=0;h<c;h++)g=a[h]*b+e,e=Math.floor(g/1E7),d[h]=g-1E7*e;for(;0<e;)d[h++]=e%1E7,e=Math.floor(e/1E7);return d}function V(a,
b){for(var c=[];0<b--;)c.push(0);return c.concat(a)}function M(a,b){var c=Math.max(a.length,b.length);if(30>=c)return Q(a,b);var c=Math.ceil(c/2),d=a.slice(c),e=a.slice(0,c),g=b.slice(c),h=b.slice(0,c),f=M(e,h),k=M(d,g),d=M(A(e,d),A(h,g)),c=A(A(f,V(x(x(d,f),k),c)),V(k,2*c));l(c);return c}function W(a,c,d){return 1E7>a?new b(J(c,a),d):new b(Q(c,h(a)),d)}function X(a){var b=a.length,c=k(b+b),d,e,g,h;for(g=0;g<b;g++){h=a[g];e=0-h*h;for(var f=g;f<b;f++)d=a[f],d=2*h*d+c[g+f]+e,e=Math.floor(d/1E7),c[g+
f]=d-1E7*e;c[g+b]=e}l(c);return c}function Y(a,b){var c=a.length,d=k(c),e,g;g=0;for(--c;0<=c;--c)g=1E7*g+a[c],e=n(g/b),g-=e*b,d[c]=e|0;return[d,g|0]}function G(a,fa){var f,y=m(fa);if(N)return[new e(a.value/y.value),new e(a.value%y.value)];var p=a.value;f=y.value;if(0===f)throw Error("Cannot divide by zero");if(a.isSmall)return y.isSmall?[new d(n(p/f)),new d(p%f)]:[c[0],a];if(y.isSmall){if(1===f)return[a,c[0]];if(-1==f)return[a.negate(),c[0]];f=Math.abs(f);if(1E7>f)return f=Y(p,f),p=g(f[0]),f=f[1],
a.sign&&(f=-f),"number"===typeof p?(a.sign!==y.sign&&(p=-p),[new d(p),new d(f)]):[new b(p,a.sign!==y.sign),new d(f)];f=h(f)}var z=F(p,f);if(-1===z)return[c[0],a];if(0===z)return[c[a.sign===y.sign?1:-1],c[0]];if(200>=p.length+f.length){var r=f,q=p.length;f=r.length;var z=k(r.length),E=r[f-1],u=Math.ceil(1E7/(2*E)),p=J(p,u),r=J(r,u),t,v,B,w,A,D;p.length<=q&&p.push(0);r.push(0);E=r[f-1];for(t=q-f;0<=t;t--){q=9999999;p[t+f]!==E&&(q=Math.floor((1E7*p[t+f]+p[t+f-1])/E));B=v=0;A=r.length;for(w=0;w<A;w++)v+=
q*r[w],D=Math.floor(v/1E7),B+=p[t+w]-(v-1E7*D),v=D,0>B?(p[t+w]=B+1E7,B=-1):(p[t+w]=B,B=0);for(;0!==B;){--q;for(w=v=0;w<A;w++)v+=p[t+w]-1E7+r[w],0>v?(p[t+w]=v+1E7,v=0):(p[t+w]=v,v=1);B+=v}z[t]=q}p=Y(p,u)[0];f=[g(z),g(p)]}else{z=p.length;E=f.length;u=[];for(r=[];z;)if(r.unshift(p[--z]),l(r),0>F(r,f))u.push(0);else{q=r.length;t=1E7*r[q-1]+r[q-2];v=1E7*f[E-1]+f[E-2];q>E&&(t=1E7*(t+1));q=Math.ceil(t/v);do{t=J(f,q);if(0>=F(t,r))break;q--}while(q);u.push(q);r=x(r,t)}u.reverse();f=[g(u),g(r)]}p=f[0];y=a.sign!==
y.sign;f=f[1];z=a.sign;"number"===typeof p?(y&&(p=-p),p=new d(p)):p=new b(p,y);"number"===typeof f?(z&&(f=-f),f=new d(f)):f=new b(f,z);return[p,f]}function F(a,b){if(a.length!==b.length)return a.length>b.length?1:-1;for(var c=a.length-1;0<=c;c--)if(a[c]!==b[c])return a[c]>b[c]?1:-1;return 0}function Z(a){a=a.abs();if(a.isUnit())return!1;if(a.equals(2)||a.equals(3)||a.equals(5))return!0;if(a.isEven()||a.isDivisibleBy(3)||a.isDivisibleBy(5))return!1;if(a.lesser(49))return!0}function R(a,b){for(var c=
a.prev(),d=c,e=0,f,g,h;d.isEven();)d=d.divide(2),e++;g=0;a:for(;g<b.length;g++)if(!a.lesser(b[g])&&(h=bigInt(b[g]).modPow(d,a),!h.isUnit()&&!h.equals(c))){for(f=e-1;0!=f;f--){h=h.square().mod(a);if(h.isUnit())break;if(h.equals(c))continue a}return!1}return!0}function S(a,b,c){b=m(b);var d=a.isNegative(),e=b.isNegative();a=d?a.not():a;var g=e?b.not():b,f=0,h=0,l=null,k=null;for(b=[];!a.isZero()||!g.isZero();)l=G(a,H),f=l[1].toJSNumber(),d&&(f=H-1-f),k=G(g,H),h=k[1].toJSNumber(),e&&(h=H-1-h),a=l[0],
g=k[0],b.push(c(f,h));c=0!==c(d?1:0,e?1:0)?bigInt(-1):bigInt(0);for(d=b.length-1;0<=d;--d)c=c.multiply(H).add(bigInt(b[d]));return c}function O(a){a=a.value;a="number"===typeof a?a|1073741824:"bigint"===typeof a?a|BigInt(1073741824):a[0]+1E7*a[1]|1073758208;return a&-a}function aa(a,b){if(0>=b.compareTo(a)){var c=aa(a,b.square(b)),d=c.p,c=c.e,e=d.multiply(b);return 0>=e.compareTo(a)?{p:e,e:2*c+1}:{p:d,e:2*c}}return{p:bigInt(1),e:0}}function ba(a,b){a=m(a);b=m(b);return a.greater(b)?a:b}function T(a,
b){a=m(a);b=m(b);return a.lesser(b)?a:b}function ca(a,b){a=m(a).abs();b=m(b).abs();if(a.equals(b))return a;if(a.isZero())return b;if(b.isZero())return a;for(var d=c[1],e;a.isEven()&&b.isEven();)e=T(O(a),O(b)),a=a.divide(e),b=b.divide(e),d=d.multiply(e);for(;a.isEven();)a=a.divide(O(a));do{for(;b.isEven();)b=b.divide(O(b));a.greater(b)&&(e=b,b=a,a=e);b=b.subtract(a)}while(!b.isZero());return d.isUnit()?a:a.multiply(d)}function U(a,b,d){var e=c[0],g=c[1],f;for(f=a.length-1;0<=f;f--)e=e.add(a[f].times(g)),
g=g.times(b);return d?e.negate():e}function K(a,b){b=bigInt(b);if(b.isZero()){if(a.isZero())return{value:[0],isNegative:!1};throw Error("Cannot convert nonzero numbers to base 0.");}if(b.equals(-1)){if(a.isZero())return{value:[0],isNegative:!1};if(a.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-a.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var c=Array.apply(null,Array(a.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);c.unshift([1]);return{value:[].concat.apply([],
c),isNegative:!1}}c=!1;a.isNegative()&&b.isPositive()&&(c=!0,a=a.abs());if(b.isUnit())return a.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(a.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:c};for(var d=[],e=a,f;e.isNegative()||0<=e.compareAbs(b);)f=e.divmod(b),e=f.quotient,f=f.remainder,f.isNegative()&&(f=b.minus(f).abs(),e=e.next()),d.push(f.toJSNumber());d.push(e.toJSNumber());return{value:d.reverse(),isNegative:c}}function da(a,b,c){a=K(a,b);return(a.isNegative?"-":
"")+a.value.map(function(a){var b=c,b=b||"0123456789abcdefghijklmnopqrstuvwxyz";a=a<b.length?b[a]:"<"+a+">";return a}).join("")}function ea(a){if(f(+a)){var c=+a;if(c===n(c))return N?new e(BigInt(c)):new d(c);throw Error("Invalid integer: "+a);}(c="-"===a[0])&&(a=a.slice(1));var g=a.split(/e/i);if(2<g.length)throw Error("Invalid integer: "+g.join("e"));if(2===g.length){a=g[1];"+"===a[0]&&(a=a.slice(1));a=+a;if(a!==n(a)||!f(a))throw Error("Invalid integer: "+a+" is not a valid exponent.");var g=g[0],
h=g.indexOf(".");0<=h&&(a-=g.length-h-1,g=g.slice(0,h)+g.slice(h+1));if(0>a)throw Error("Cannot include negative exponent part for integers");a=g+=Array(a+1).join("0")}if(!/^([0-9][0-9]*)$/.test(a))throw Error("Invalid integer: "+a);if(N)return new e(BigInt(c?"-"+a:a));for(var g=[],h=a.length,k=h-7;0<h;)g.push(+a.slice(k,h)),k-=7,0>k&&(k=0),h-=7;l(g);return new b(g,c)}function m(a){if("number"===typeof a){if(N)a=new e(BigInt(a));else if(f(a)){if(a!==n(a))throw Error(a+" is not an integer.");a=new d(a)}else a=
ea(a.toString());return a}return"string"===typeof a?ea(a):"bigint"===typeof a?new e(a):a}var P=h(9007199254740992),N="function"===typeof BigInt;b.prototype=Object.create(c.prototype);d.prototype=Object.create(c.prototype);e.prototype=Object.create(c.prototype);b.prototype.add=function(a){a=m(a);if(this.sign!==a.sign)return this.subtract(a.negate());var c=this.value,d=a.value;return a.isSmall?new b(u(c,Math.abs(d)),this.sign):new b(A(c,d),this.sign)};b.prototype.plus=b.prototype.add;d.prototype.add=
function(a){a=m(a);var c=this.value;if(0>c!==a.sign)return this.subtract(a.negate());var e=a.value;if(a.isSmall){if(f(c+e))return new d(c+e);e=h(Math.abs(e))}return new b(u(e,Math.abs(c)),0>c)};d.prototype.plus=d.prototype.add;e.prototype.add=function(a){return new e(this.value+m(a).value)};e.prototype.plus=e.prototype.add;b.prototype.subtract=function(a){var c=m(a);if(this.sign!==c.sign)return this.add(c.negate());a=this.value;var e=c.value;if(c.isSmall)return D(a,Math.abs(e),this.sign);c=this.sign;
0<=F(a,e)?a=x(a,e):(a=x(e,a),c=!c);a=g(a);"number"===typeof a?(c&&(a=-a),a=new d(a)):a=new b(a,c);return a};b.prototype.minus=b.prototype.subtract;d.prototype.subtract=function(a){a=m(a);var b=this.value;if(0>b!==a.sign)return this.add(a.negate());var c=a.value;return a.isSmall?new d(b-c):D(c,Math.abs(b),0<=b)};d.prototype.minus=d.prototype.subtract;e.prototype.subtract=function(a){return new e(this.value-m(a).value)};e.prototype.minus=e.prototype.subtract;b.prototype.negate=function(){return new b(this.value,
!this.sign)};d.prototype.negate=function(){var a=this.sign,b=new d(-this.value);b.sign=!a;return b};e.prototype.negate=function(){return new e(-this.value)};b.prototype.abs=function(){return new b(this.value,!1)};d.prototype.abs=function(){return new d(Math.abs(this.value))};e.prototype.abs=function(){return new e(0<=this.value?this.value:-this.value)};b.prototype.multiply=function(a){var d=m(a);a=this.value;var e=d.value,g=this.sign!==d.sign;if(d.isSmall){if(0===e)return c[0];if(1===e)return this;
if(-1===e)return this.negate();e=Math.abs(e);if(1E7>e)return new b(J(a,e),g);e=h(e)}var d=a.length,f=e.length;return 0<-.012*d-.012*f+1.5E-5*d*f?new b(M(a,e),g):new b(Q(a,e),g)};b.prototype.times=b.prototype.multiply;d.prototype._multiplyBySmall=function(a){return f(a.value*this.value)?new d(a.value*this.value):W(Math.abs(a.value),h(Math.abs(this.value)),this.sign!==a.sign)};b.prototype._multiplyBySmall=function(a){return 0===a.value?c[0]:1===a.value?this:-1===a.value?this.negate():W(Math.abs(a.value),
this.value,this.sign!==a.sign)};d.prototype.multiply=function(a){return m(a)._multiplyBySmall(this)};d.prototype.times=d.prototype.multiply;e.prototype.multiply=function(a){return new e(this.value*m(a).value)};e.prototype.times=e.prototype.multiply;b.prototype.square=function(){return new b(X(this.value),!1)};d.prototype.square=function(){var a=this.value*this.value;return f(a)?new d(a):new b(X(h(Math.abs(this.value))),!1)};e.prototype.square=function(a){return new e(this.value*this.value)};b.prototype.divmod=
function(a){a=G(this,a);return{quotient:a[0],remainder:a[1]}};e.prototype.divmod=d.prototype.divmod=b.prototype.divmod;b.prototype.divide=function(a){return G(this,a)[0]};e.prototype.over=e.prototype.divide=function(a){return new e(this.value/m(a).value)};d.prototype.over=d.prototype.divide=b.prototype.over=b.prototype.divide;b.prototype.mod=function(a){return G(this,a)[1]};e.prototype.mod=e.prototype.remainder=function(a){return new e(this.value%m(a).value)};d.prototype.remainder=d.prototype.mod=
b.prototype.remainder=b.prototype.mod;b.prototype.pow=function(a){var b=m(a),e=this.value;a=b.value;var g;if(0===a)return c[1];if(0===e)return c[0];if(1===e)return c[1];if(-1===e)return b.isEven()?c[1]:c[-1];if(b.sign)return c[0];if(!b.isSmall)throw Error("The exponent "+b.toString()+" is too large.");if(this.isSmall&&f(g=Math.pow(e,a)))return new d(n(g));g=this;for(b=c[1];;){a&1&&(b=b.times(g),--a);if(0===a)break;a/=2;g=g.square()}return b};d.prototype.pow=b.prototype.pow;e.prototype.pow=function(a){var b=
m(a),d=this.value;a=b.value;var g=BigInt(0),f=BigInt(1),h=BigInt(2);if(a===g)return c[1];if(d===g)return c[0];if(d===f)return c[1];if(d===BigInt(-1))return b.isEven()?c[1]:c[-1];if(b.isNegative())return new e(g);b=this;for(d=c[1];;){(a&f)===f&&(d=d.times(b),--a);if(a===g)break;a/=h;b=b.square()}return d};b.prototype.modPow=function(a,b){a=m(a);b=m(b);if(b.isZero())throw Error("Cannot take modPow with modulus 0");for(var d=c[1],e=this.mod(b);a.isPositive();){if(e.isZero())return c[0];a.isOdd()&&(d=
d.multiply(e).mod(b));a=a.divide(2);e=e.square().mod(b)}return d};e.prototype.modPow=d.prototype.modPow=b.prototype.modPow;b.prototype.compareAbs=function(a){a=m(a);return a.isSmall?1:F(this.value,a.value)};d.prototype.compareAbs=function(a){a=m(a);var b=Math.abs(this.value),c=a.value;return a.isSmall?(c=Math.abs(c),b===c?0:b>c?1:-1):-1};e.prototype.compareAbs=function(a){var b=this.value;a=m(a).value;b=0<=b?b:-b;a=0<=a?a:-a;return b===a?0:b>a?1:-1};b.prototype.compare=function(a){if(Infinity===a)return-1;
if(-Infinity===a)return 1;a=m(a);return this.sign!==a.sign?a.sign?1:-1:a.isSmall?this.sign?-1:1:F(this.value,a.value)*(this.sign?-1:1)};b.prototype.compareTo=b.prototype.compare;d.prototype.compare=function(a){if(Infinity===a)return-1;if(-Infinity===a)return 1;a=m(a);var b=this.value,c=a.value;return a.isSmall?b==c?0:b>c?1:-1:0>b!==a.sign?0>b?-1:1:0>b?1:-1};d.prototype.compareTo=d.prototype.compare;e.prototype.compare=function(a){if(Infinity===a)return-1;if(-Infinity===a)return 1;var b=this.value;
a=m(a).value;return b===a?0:b>a?1:-1};e.prototype.compareTo=e.prototype.compare;b.prototype.equals=function(a){return 0===this.compare(a)};e.prototype.eq=e.prototype.equals=d.prototype.eq=d.prototype.equals=b.prototype.eq=b.prototype.equals;b.prototype.notEquals=function(a){return 0!==this.compare(a)};e.prototype.neq=e.prototype.notEquals=d.prototype.neq=d.prototype.notEquals=b.prototype.neq=b.prototype.notEquals;b.prototype.greater=function(a){return 0<this.compare(a)};e.prototype.gt=e.prototype.greater=
d.prototype.gt=d.prototype.greater=b.prototype.gt=b.prototype.greater;b.prototype.lesser=function(a){return 0>this.compare(a)};e.prototype.lt=e.prototype.lesser=d.prototype.lt=d.prototype.lesser=b.prototype.lt=b.prototype.lesser;b.prototype.greaterOrEquals=function(a){return 0<=this.compare(a)};e.prototype.geq=e.prototype.greaterOrEquals=d.prototype.geq=d.prototype.greaterOrEquals=b.prototype.geq=b.prototype.greaterOrEquals;b.prototype.lesserOrEquals=function(a){return 0>=this.compare(a)};e.prototype.leq=
e.prototype.lesserOrEquals=d.prototype.leq=d.prototype.lesserOrEquals=b.prototype.leq=b.prototype.lesserOrEquals;b.prototype.isEven=function(){return 0===(this.value[0]&1)};d.prototype.isEven=function(){return 0===(this.value&1)};e.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)};b.prototype.isOdd=function(){return 1===(this.value[0]&1)};d.prototype.isOdd=function(){return 1===(this.value&1)};e.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)};b.prototype.isPositive=
function(){return!this.sign};d.prototype.isPositive=function(){return 0<this.value};e.prototype.isPositive=d.prototype.isPositive;b.prototype.isNegative=function(){return this.sign};d.prototype.isNegative=function(){return 0>this.value};e.prototype.isNegative=d.prototype.isNegative;b.prototype.isUnit=function(){return!1};d.prototype.isUnit=function(){return 1===Math.abs(this.value)};e.prototype.isUnit=function(){return this.abs().value===BigInt(1)};b.prototype.isZero=function(){return!1};d.prototype.isZero=
function(){return 0===this.value};e.prototype.isZero=function(){return this.value===BigInt(0)};b.prototype.isDivisibleBy=function(a){a=m(a);return a.isZero()?!1:a.isUnit()?!0:0===a.compareAbs(2)?this.isEven():this.mod(a).isZero()};e.prototype.isDivisibleBy=d.prototype.isDivisibleBy=b.prototype.isDivisibleBy;b.prototype.isPrime=function(b){var c=Z(this);if(c!==a)return c;var c=this.abs(),d=c.bitLength();if(64>=d)return R(c,[2,3,5,7,11,13,17,19,23,29,31,37]);d=Math.log(2)*d.toJSNumber();b=Math.ceil(!0===
b?2*Math.pow(d,2):d);for(var d=[],e=0;e<b;e++)d.push(bigInt(e+2));return R(c,d)};e.prototype.isPrime=d.prototype.isPrime=b.prototype.isPrime;b.prototype.isProbablePrime=function(b){var c=Z(this);if(c!==a)return c;c=this.abs();b=b===a?5:b;for(var d=[],e=0;e<b;e++)d.push(bigInt.randBetween(2,c.minus(2)));return R(c,d)};e.prototype.isProbablePrime=d.prototype.isProbablePrime=b.prototype.isProbablePrime;b.prototype.modInv=function(a){for(var b=bigInt.zero,c=bigInt.one,d=m(a),e=this.abs(),g,f,h;!e.isZero();)g=
d.divide(e),f=b,h=d,b=c,d=e,c=f.subtract(g.multiply(c)),e=h.subtract(g.multiply(e));if(!d.isUnit())throw Error(this.toString()+" and "+a.toString()+" are not co-prime");-1===b.compare(0)&&(b=b.add(a));return this.isNegative()?b.negate():b};e.prototype.modInv=d.prototype.modInv=b.prototype.modInv;b.prototype.next=function(){var a=this.value;return this.sign?D(a,1,this.sign):new b(u(a,1),this.sign)};d.prototype.next=function(){var a=this.value;return 9007199254740992>a+1?new d(a+1):new b(P,!1)};e.prototype.next=
function(){return new e(this.value+BigInt(1))};b.prototype.prev=function(){var a=this.value;return this.sign?new b(u(a,1),!0):D(a,1,this.sign)};d.prototype.prev=function(){var a=this.value;return-9007199254740992<a-1?new d(a-1):new b(P,!0)};e.prototype.prev=function(){return new e(this.value-BigInt(1))};for(var C=[1];1E7>=2*C[C.length-1];)C.push(2*C[C.length-1]);var L=C.length,H=C[L-1];b.prototype.shiftLeft=function(a){a=m(a).toJSNumber();if(!(1E7>=Math.abs(a)))throw Error(String(a)+" is too large for shifting.");
if(0>a)return this.shiftRight(-a);var b=this;if(b.isZero())return b;for(;a>=L;)b=b.multiply(H),a-=L-1;return b.multiply(C[a])};e.prototype.shiftLeft=d.prototype.shiftLeft=b.prototype.shiftLeft;b.prototype.shiftRight=function(a){var b;a=m(a).toJSNumber();if(!(1E7>=Math.abs(a)))throw Error(String(a)+" is too large for shifting.");if(0>a)return this.shiftLeft(-a);for(b=this;a>=L;){if(b.isZero()||b.isNegative()&&b.isUnit())return b;b=G(b,H);b=b[1].isNegative()?b[0].prev():b[0];a-=L-1}b=G(b,C[a]);return b[1].isNegative()?
b[0].prev():b[0]};e.prototype.shiftRight=d.prototype.shiftRight=b.prototype.shiftRight;b.prototype.not=function(){return this.negate().prev()};e.prototype.not=d.prototype.not=b.prototype.not;b.prototype.and=function(a){return S(this,a,function(a,b){return a&b})};e.prototype.and=d.prototype.and=b.prototype.and;b.prototype.or=function(a){return S(this,a,function(a,b){return a|b})};e.prototype.or=d.prototype.or=b.prototype.or;b.prototype.xor=function(a){return S(this,a,function(a,b){return a^b})};e.prototype.xor=
d.prototype.xor=b.prototype.xor;b.prototype.bitLength=function(){var a=this;0>a.compareTo(bigInt(0))&&(a=a.negate().subtract(bigInt(1)));return 0===a.compareTo(bigInt(0))?bigInt(0):bigInt(aa(a,bigInt(2)).e).add(bigInt(1))};e.prototype.bitLength=d.prototype.bitLength=b.prototype.bitLength;b.prototype.toArray=function(a){return K(this,a)};d.prototype.toArray=function(a){return K(this,a)};e.prototype.toArray=function(a){return K(this,a)};b.prototype.toString=function(b,c){b===a&&(b=10);if(10!==b)return da(this,
b,c);for(var d=this.value,e=d.length,g=String(d[--e]),f;0<=--e;)f=String(d[e]),g+="0000000".slice(f.length)+f;return(this.sign?"-":"")+g};d.prototype.toString=function(b,c){b===a&&(b=10);return 10!=b?da(this,b,c):String(this.value)};e.prototype.toString=d.prototype.toString;e.prototype.toJSON=b.prototype.toJSON=d.prototype.toJSON=function(){return this.toString()};b.prototype.valueOf=function(){return parseInt(this.toString(),10)};b.prototype.toJSNumber=b.prototype.valueOf;d.prototype.valueOf=function(){return this.value};
d.prototype.toJSNumber=d.prototype.valueOf;e.prototype.valueOf=e.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};for(var I=0;1E3>I;I++)c[I]=m(I),0<I&&(c[-I]=m(-I));c.one=c[1];c.zero=c[0];c.minusOne=c[-1];c.max=ba;c.min=T;c.gcd=ca;c.lcm=function(a,b){a=m(a).abs();b=m(b).abs();return a.divide(ca(a,b)).multiply(b)};c.isInstance=function(a){return a instanceof b||a instanceof d||a instanceof e};c.randBetween=function(a,b){a=m(a);b=m(b);var d=T(a,b),e=ba(a,b).subtract(d).add(1);if(e.isSmall)return d.add(Math.floor(Math.random()*
e));for(var e=K(e,1E7).value,g=[],f=!0,h=0;h<e.length;h++){var k=f?e[h]:1E7,l=n(Math.random()*k);g.push(l);l<k&&(f=!1)}return d.add(c.fromArray(g,1E7,!1))};c.fromArray=function(a,b,c){return U(a.map(m),m(b||10),c)};return c}();"undefined"!==typeof module&&module.hasOwnProperty("exports")&&(module.exports=bigInt);"function"===typeof define&&define.amd&&define("big-integer",[],function(){return bigInt});"use strict";var lnn={api:{}};lnn.api.version="0.1";lnn.api.url="/lightnion/api/v0.1";
lnn.api.ws_port="8765";lnn.state={started:1,guarded:2,created:3,pending:4,extpath:5,success:6,started:1,created:3,pending:4,success:6};
lnn.endpoint=function(a,c){var b="http://"+a+":"+c.toString(),b=b+lnn.api.url,d="ws://"+a+":"+lnn.api.ws_port,d=d+lnn.api.url,e={host:a,port:c,fast:null,auth:null,urls:{ws:d,http:b,guard:b+"/guard",socket:d+"/channels",channels:b+"/channels",consensus:b+"/consensus",descriptors:b+"/descriptors",signing_keys:b+"/signing-keys"},io:null,state:0,material:null,forward:null,backward:null,id:null,url:null,path:null,guard:null,stream:null,consensus:null,descriptors:null,consensus_raw:null,descriptors_raw:null,
signing_keys:null,select_path:!1,http_request:function(a,b,c,d,k,n){void 0===n&&(n=function(){});void 0===k&&(k=function(){});lnn.send_req(e,a,b,c,d,k,n)},close:function(a,b){lnn.post.close(e,a,b)}};return e};lnn.get={};lnn.get.guard=function(a,c,b){fetch(a.urls.guard,{method:"GET"}).then(function(d){200==d.status?d.json().then(function(b){a.guard=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};
lnn.get.consensus=function(a,c,b){fetch(a.urls.consensus,{method:"GET"}).then(function(d){200==d.status?d.json().then(function(b){a.consensus=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};lnn.get.descriptors=function(a,c,b){fetch(a.urls.descriptors,{method:"GET"}).then(function(d){200==d.status?d.json().then(function(b){a.descriptors=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};
lnn.get.consensus_raw=function(a,c,b,d){fetch(a.urls.consensus+"-raw/"+(void 0===d?"microdesc":d),{method:"GET"}).then(function(d){200==d.status?d.text().then(function(b){a.consensus_raw=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};lnn.get.descriptors_raw=function(a,c,b,d){fetch(a.urls.descriptors+"-raw/"+(void 0===d?"microdesc":d),{method:"GET"}).then(function(d){200==d.status?d.text().then(function(b){a.descriptors_raw=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};
lnn.get.signing_keys=function(a,c,b){fetch(a.urls.signing_keys,{method:"GET"}).then(function(d){200==d.status?d.json().then(function(b){a.signing_keys=b;void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};lnn.ntor={};lnn.ntor.keybytes=92;lnn.ntor.protoid="ntor-curve25519-sha256-1";lnn.ntor.tweaks={expand:lnn.ntor.protoid+":key_expand",key:lnn.ntor.protoid+":key_extract",verify:lnn.ntor.protoid+":verify",server:lnn.ntor.protoid+"Server",mac:lnn.ntor.protoid+":mac"};
lnn.ntor.hash_factory=function(a){a=lnn.ntor.tweaks[a];a=sjcl.codec.utf8String.toBits(a);var c={hmac:new sjcl.misc.hmac(a),encrypt:function(a){a=lnn.enc.bits(a);a=c.hmac.encrypt(a);return lnn.dec.bits(a)}};return c};lnn.ntor.hash={verify:lnn.ntor.hash_factory("verify"),mac:lnn.ntor.hash_factory("mac"),prk:lnn.ntor.hash_factory("key")};
lnn.ntor.kdf=function(a,c){a=lnn.ntor.hash.prk.encrypt(a);for(var b=new sjcl.misc.hmac(lnn.enc.bits(a)),d=lnn.ntor.tweaks.expand,d=sjcl.codec.utf8String.toBits(d),e=1,f=lnn.enc.bits([]),h=lnn.enc.bits([]);sjcl.bitArray.bitLength(f)<8*c;)var g=lnn.enc.bits([e]),g=sjcl.bitArray.concat(d,g),h=b.encrypt(sjcl.bitArray.concat(h,g)),f=sjcl.bitArray.concat(f,h),e=e+1;return lnn.dec.bits(sjcl.bitArray.clamp(f,8*c))};
lnn.ntor.hand=function(a,c,b){void 0===b&&(b=!0);void 0===c&&(c=a.guard);var d=lnn.dec.base64(c.router.identity+"=");c=lnn.dec.base64(c["ntor-onion-key"]);a.material={ntor:nacl.box.keyPair(),identity:d,onionkey:c};a=a.material.ntor.publicKey;var e=new Uint8Array(d.length+c.length+a.length);e.set(d,0);e.set(c,d.length);e.set(a,d.length+c.length);return b?lnn.enc.base64(e):e};
lnn.ntor.fast=function(a){a.material={};a.material.ntor=nacl.box.keyPair();a.material.identity=null;a.material.onionkey=null;return lnn.enc.base64(a.material.ntor.publicKey)};
lnn.ntor.shake=function(a,c,b){void 0===b&&(b=!0);b&&(c=lnn.dec.base64(c));var d=a.material.ntor.publicKey;b=a.material.ntor.secretKey;var e=c.slice(0,nacl.scalarMult.scalarLength);c=c.slice(nacl.scalarMult.scalarLength);var f=a.material.identity,h=a.material.onionkey;a=nacl.scalarMult(b,e);b=nacl.scalarMult(b,h);var g=lnn.dec.utf8(lnn.ntor.protoid),l=2*a.length+f.length+3*h.length,k=0,n=new Uint8Array(l+g.length);n.set(a,k);k+=a.length;n.set(b,k);k+=b.length;n.set(f,k);k+=f.length;n.set(h,k);k+=
h.length;n.set(d,k);k+=d.length;n.set(e,k);k+=e.length;n.set(g,k);var g=lnn.ntor.hash.verify.encrypt(n),q=lnn.dec.utf8(lnn.ntor.tweaks.server),l=g.length+f.length+3*h.length,k=0,l=new Uint8Array(l+q.length);l.set(g,k);k+=g.length;l.set(f,k);k+=f.length;l.set(h,k);k+=h.length;l.set(e,k);k+=e.length;l.set(d,k);k+=d.length;l.set(q,k);f=lnn.ntor.hash.mac.encrypt(l);d=!0;l=f.length;for(e=0;e<l;e++)f[e]!=c[e]&&(d=!1);f=c=0;l=b.length;for(e=0;e<l;e++)0==b[e]&&(c+=1),0==a[e]&&(f+=1);if(c==b.length||f==a.length)d=
!1;return d?lnn.ntor.kdf(n,lnn.ntor.keybytes):null};lnn.ntor.slice=function(a){return a={key_hash:a.slice(72),forward_digest:a.slice(0,20),backward_digest:a.slice(20,40),forward_key:a.slice(40,56),backward_key:a.slice(56,72)}};lnn.ntor.auth=function(a,c,b){var d=a.material;a.material=a.auth;b=lnn.dec.base64(b);c=lnn.ntor.shake(a,c);if(null==c)throw"Invalid auth.";a.material=d;a=c.slice(0,32);d=c.slice(32,56);b=nacl.secretbox.open(b,d,a);return JSON.parse(lnn.enc.utf8(b))};lnn.relay={};
lnn.relay.payload_len=509;lnn.relay.data_len=lnn.relay.payload_len-11;lnn.relay.full_len=5+lnn.relay.payload_len;lnn.relay.cmd={begin:1,1:"begin",data:2,2:"data",end:3,3:"end",connected:4,4:"connected",sendme:5,5:"sendme",extend:6,6:"extend",extended:7,7:"extended",truncate:8,8:"truncate",truncated:9,9:"truncated",drop:10,10:"drop",resolve:11,11:"resolve",resolved:12,12:"resolved",begin_dir:13,13:"begin_dir",extend2:14,14:"extend2",extended2:15,15:"extended2"};
lnn.relay.pack=function(a,c,b){void 0===b&&(b=new Uint8Array(0));void 0===c&&(c=0);"string"==typeof b&&(b=lnn.dec.utf8(b));var d=new Uint8Array(lnn.relay.full_len),e=new DataView(d.buffer);e.setUint32(0,2147483648,!1);e.setUint8(4,3,!1);e.setUint8(5,lnn.relay.cmd[a],!1);e.setUint16(6,0,!1);e.setUint16(8,c,!1);e.setUint16(14,b.length,!1);d.set(b,16);return d};
lnn.relay.extend=function(a,c,b,d,e){var f=new Uint8Array(c.split("."));if(f.join(".")!=c)throw"Invalid extend IPv4 address, fatal.";b=parseInt(b);"string"==typeof d&&(d=lnn.dec.base64(d));"string"==typeof e&&(e=lnn.dec.base64(e+"="));c=2;void 0!==e&&(c+=1);var h=11+d.length+2+2+a.length;3==c&&(h+=2+e.length);var g=0,h=new Uint8Array(h),l=new DataView(h.buffer);l.setUint8(g,c,!1);g+=1;l.setUint8(g,0,!1);g+=1;l.setUint8(g,6,!1);g+=1;h.set(f,g);g+=4;l.setUint16(g,b,!1);g+=2;l.setUint8(g,2,!1);g+=1;
l.setUint8(g,d.length,!1);g+=1;h.set(d,g);g+=d.length;3==c&&(l.setUint8(g,3,!1),g+=1,l.setUint8(g,e.length,!1),g+=1,h.set(e,g),g+=e.length);l.setUint16(g,2,!1);g+=2;l.setUint16(g,a.length,!1);h.set(a,g+2);return h};
lnn.relay.begin=function(a,c){valid=!1;a.match("(\\d+\\.){3}\\d+")&&(valid=!0);a.match("^\\[[\\d:]*\\]$")&&(valid=!0);valid||"."==a.slice(-1)||(a+=".");a.match("^([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)*$")&&(valid=!0);"."==a.slice(-1)&&(a=a.slice(0,-1));if(!valid)throw"Invalid host provided?";var b=lnn.dec.utf8(a+":"+c),d=new Uint8Array(b.length+1+4);d.set(b,0);d[b.length+1+3]=5;return d};lnn.onion={};
lnn.onion.ctr=function(a){a=lnn.enc.bits(a);var c={prf:new sjcl.cipher.aes(a),nonce:0,buffer:new Uint8Array(0),extend:function(a){a=16*(Math.floor(a/16)+1);var d=c.buffer;c.buffer=new Uint8Array(a+d.length);c.buffer.set(d,0);for(a=d.length;a<c.buffer.length;a+=16)d=new Uint8Array(16),(new DataView(d.buffer)).setUint32(12,c.nonce,!1),d=lnn.enc.bits(d),d=lnn.dec.bits(c.prf.encrypt(d)),c.buffer.set(d,a),c.nonce+=1},process:function(a){a.length>c.buffer.length&&c.extend(a.length);a=a.slice(0);for(var d=
0;d<a.length;d++)a[d]^=c.buffer[d];c.buffer=c.buffer.slice(a.length);return a}};return c};lnn.onion.sha=function(a){a=lnn.enc.bits(a);var c={hash:new sjcl.hash.sha1,digest:function(a){c.hash.update(lnn.enc.bits(a));a=(new sjcl.hash.sha1(c.hash)).finalize();return lnn.dec.bits(a)}};c.hash.update(a);return c};
lnn.onion.forward=function(a){var c=8,b=[];null!=a.forward&&(b=a.forward.layers,b.push(a.forward),c=a.forward.early);var d={iv:0,ctr:lnn.onion.ctr(a.material.forward_key),sha:lnn.onion.sha(a.material.forward_digest),early:c,layers:b,encrypt:function(a){if(a.length!=lnn.relay.full_len)throw"Invalid size for cell, fatal.";for(var b=a.slice(5),c=0;c<d.layers.length;c++)b.set(d.layers[c].ctr.process(b),0);a.set(d.ctr.process(b),5);0<d.early&&3==a[4]&&(--d.early,a[4]=9);return a},digest:function(a){if(a.length!=
lnn.relay.full_len)throw"Invalid size for cell, fatal.";a=a.slice(5);a.set(new Uint8Array(4),5);return d.sha.digest(a).slice(0,4)}};return d};
lnn.onion.backward=function(a){var c=[];null!=a.backward&&(c=a.backward.layers,c.push(a.backward));var b={iv:0,ctr:lnn.onion.ctr(a.material.backward_key),sha:lnn.onion.sha(a.material.backward_digest),layers:c,decrypt:function(a){if(a.length!=lnn.relay.full_len)throw"Invalid size for cell, fatal.";for(var c=a.slice(5),f=0;f<b.layers.length;f++){c.set(b.layers[f].ctr.process(c),0);a.set(c,5);var h=a.slice(6,8);if(h[0]==h[1]&&0==h[0]){var g=a.slice(10,14),h=b.layers[f].digest(a),l=(new DataView(a.slice(14,
16).buffer)).getUint16(0,!1);if(h[0]==g[0]&&h[1]==g[1]&&h[2]==g[2]&&h[3]==g[3]&&l<=lnn.relay.data_len)return console.log("Warning: Cell sent by intermediate                                 tor node, after "+(f+1)+" hop(s)"),a}}a.set(b.ctr.process(c),5);g=a.slice(10,14);a.set(new Uint8Array(4),10);h=a.slice(6,8);if(h[0]!=h[1]||0!=h[0])throw"Invalid cell recognized field.";h=b.digest(a);if(g[0]!=h[0]||g[1]!=h[1]||g[2]!=h[2]||g[3]!=h[3])throw"Invalid cell digest.";l=(new DataView(a.slice(14,16).buffer)).getUint16(0,
!1);if(l>lnn.relay.data_len)throw"Invalid cell data length.";return a},digest:function(a){if(a.length!=lnn.relay.full_len)throw"Invalid size for cell, fatal.";a=a.slice(5);a.set(new Uint8Array(4),5);return b.sha.digest(a).slice(0,4)}};return b};lnn.onion.build=function(a,c,b,d){c=lnn.relay.pack(c,b,d);c.set(a.forward.digest(c),10);return a.forward.encrypt(c)};
lnn.onion.peel=function(a,c){c=a.backward.decrypt(c);var b=(new DataView(c.slice(14,16).buffer)).getUint16(0,!1),d=(new DataView(c.slice(8,10).buffer)).getUint16(0,!1),e=lnn.relay.cmd[c.slice(5,6)[0]],b=c.slice(16,16+b);return{cmd:e,stream_id:d,data:b}};lnn.io={};
lnn.io.polling=function(a,c,b,d){var e={incoming:[],outcoming:[],pending:0,handler:c,success:b,error:d,cell:null,poll:function(){setTimeout(function(){lnn.post.channel(a,e.poll)},100)},send:function(a){e.outcoming.push(lnn.enc.base64(a))},recv:function(){if(!(1>e.incoming.length))return e.cell=e.incoming.shift(),lnn.dec.base64(e.cell)},start:function(){lnn.post.channel(a,e.poll)}};return a.io=e};
lnn.io.socket=function(a,c,b,d){void 0===c&&(c=function(a){});void 0===b&&(b=function(a){});void 0===d&&(d=function(a){});var e={event:null,socket:null,closed:!1,incoming:[],outcoming:[],handler:c,success:b,error:d,cell:null,cell_recv:0,send:function(a){e.outcoming.push(a)},recv:function(){if(!(1>e.incoming.length)){e.cell=e.incoming.shift();e.cell_recv+=1;var a=Array.from(e.cell.slice(0,20)).map(function(a){return a.toString(16).padStart(2,"0")}).join("");console.log("cell recv by wbskt ",a);return e.cell}},
start:function(){}};c=new _WebSocket(a.urls.socket+"/"+a.id);c.binaryType="arraybuffer";c.onopen=function(b){e.event=b;for(e.success(a);0<e.outcoming.length;)e.socket.send(e.outcoming.shift());e.send=function(a){if(e.closed)throw"Unable to send, connection closed.";e.socket.send(a.buffer)}};c.onerror=function(b){e.event=b;e.error(a)};c.onmessage=function(b){e.event=b;b=new Uint8Array(b.data);var c=Array.from(b.slice(0,20)).map(function(a){return a.toString(16).padStart(2,"0")}).join("");console.log("cell recv by wbskt ",
c);e.cell=b;e.handler(a,b)};c.onclose=function(b){e.event=b;e.closed=!0;e.error(a)};a.io=e;a.io.socket=c;return e};lnn.post={};
lnn.post.create=function(a,c,b){var d=null,d=a.fast?lnn.ntor.fast(a):lnn.ntor.hand(a),d={ntor:d};null!=a.auth&&(d.auth=lnn.enc.base64(a.auth.ntor.publicKey));d=JSON.stringify(d);fetch(a.urls.channels,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:d}).then(function(d){201==d.status?d.json().then(function(b){null!=a.auth&&(b=lnn.ntor.auth(a,b.auth,b.data));a.id=b.id;a.url=a.urls.channels+"/"+b.id;a.path=b.path;a.fast&&(a.guard=b.guard,a.material.identity=lnn.dec.base64(b.guard.router.identity+
"="),a.material.onionkey=lnn.dec.base64(b.guard["ntor-onion-key"]));b=lnn.ntor.shake(a,b.ntor);if(null==b)throw"Invalid guard handshake.";b=lnn.ntor.slice(b);a.material=b;a.forward=lnn.onion.forward(a);a.backward=lnn.onion.backward(a);void 0!==c&&c(a)}):void 0!==b&&b(a,d.status)})};
lnn.post.circuit_info=function(a,c,b,d,e){void 0===d&&(d=!1);var f={};null!=a.auth&&(f.auth=lnn.enc.base64(a.auth.ntor.publicKey));f.select_path=d.toString();f=JSON.stringify(f);fetch(a.urls.channels,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:f}).then(function(f){201==f.status?f.json().then(function(b){null!=a.auth&&(b=lnn.ntor.auth(a,b.auth,b.data));a.id=b.id;a.url=a.urls.channels+"/"+b.id;a.fast&&(a.guard=b.guard);d?(a.consensus=lnn.consensusParser.parse(a.consensus_raw),
a.descriptors=lnn.parser.descriptors.parse(a.descriptors_raw),lnn.parser.descriptors.validate(a.descriptors,a.consensus),a.path=lnn.path.select_end_path(a.consensus,a.descriptors,a.guard,!0,e),console.log(a.guard),console.log(a.path)):a.path=b.path;void 0!==c&&c(a,b)}):void 0!==b&&b(a,f.status)})};
lnn.post.handshake=function(a,c,b,d){var e=a.io.handler;a.io.handler=function(a,c){a.io.handler=e;c=lnn.ntor.shake(a,c.slice(7,71),!1);if(null==c)throw"Invalid guard handshake.";c=lnn.ntor.slice(c);a.material=c;a.forward=lnn.onion.forward(a);a.backward=lnn.onion.backward(a);void 0!==b&&b(a)};c=new Uint8Array(lnn.relay.full_len);d=lnn.ntor.hand(a,a.guard,!1);var f=new DataView(c.buffer);f.setUint32(0,2147483648,!1);f.setUint8(4,10,!1);f.setUint16(5,2,!1);f.setUint16(7,d.length,!1);c.set(d,9);a.io.send(c)};
lnn.post.channel=function(a,c,b){a.io.pending=a.io.outcoming.length;fetch(a.url,{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({cells:a.io.outcoming})}).then(function(d){201==d.status?d.json().then(function(b){b=b.cells;if(void 0===b)void 0!==a.io.error&&a.io.error(a);else{var d=a.io.pending;0<d&&void 0!==a.io.success&&a.io.success(a);0<b.length&&(a.io.incoming=a.io.incoming.concat(b),void 0!==a.io.handler&&a.io.handler(a));a.io.outcoming=a.io.outcoming.slice(d);
a.io.pending=0;void 0!==c&&c(a)}}):(void 0!==a.io.error&&a.io.error(a),void 0!==b&&b(a,rq.status))})};
lnn.post.extend=function(a,c,b,d){var e=lnn.ntor.hand(a,c,!1);c=lnn.relay.extend(e,c.router.address,c.router.orport,a.material.identity,c.identity["master-key"]);c=lnn.onion.build(a,"extend2",0,c);var f=a.io.handler;a.io.handler=function(a,c){a.io.handler=f;var e=lnn.onion.peel(a,c);if(null==e||"extended2"!=e.cmd){if(void 0!==d)return d(a);throw"Invalid answer, expecting extended2 cell, fatal!";}var k=(new DataView(e.data.buffer)).getUint16(0,!1);c=e.data.slice(2,2+k);e=lnn.ntor.shake(a,c,!1);e=lnn.ntor.slice(e);
a.material=e;if(null==e&&void 0!==d)return d(a);a.forward=lnn.onion.forward(a);a.backward=lnn.onion.backward(a);void 0!==b&&b(a)};a.io.send(c)};lnn.post.close=function(a,c,b){fetch(a.url,{method:"DELETE"}).then(function(a){202==a.status?void 0!==c&&c("Circuit closed"):void 0!==b&&b("Error in closing circuit")})};lnn.stream={};lnn.stream.entrancy=0;
lnn.stream.backend=function(a){var c={id:0,tosend:[],sendme:0,handles:{0:{callback:function(b,c){if("sendme"==b.cmd)for(c.stream.sendme+=1,c.stream.deliverywindow+=100;0<c.stream.deliverywindow&&0<c.stream.tosend.length;)b=c.stream.tosend.shift(),c.io.send(b),--c.stream.deliverywindow;else throw a(c),"Got unexpected control cell.";}}},packagewindow:1E3,deliverywindow:1E3,register:function(a){c.id+=1;a.id=c.id;a.packagewindow=500;a.deliverywindow=500;c.handles[c.id]=a;return c.id},send:function(a,
d){0<c.deliverywindow?(d.io.send(a),--c.deliverywindow):c.tosend.push(a)}};return c};
lnn.stream.handler=function(a,c){lnn.stream.entrancy+=1;1<lnn.stream.entrancy&&console.log("ENTRANCY BUG");if(3!=c[4])console.log("Got non-relay cell, 'dropped': ",c[4]);else if(c=lnn.onion.peel(a,c),null==c)console.log("Got invalid cell, dropped.");else if(c.stream_id in a.stream.handles){var b=a.stream.handles[c.stream_id];"end"==c.cmd&&delete a.stream.handles[c.stream_id];b.cell=c;b.callback(c,a);"data"==c.cmd&&--a.stream.packagewindow;console.log("Update window: ",a.stream.packagewindow);900>
a.stream.packagewindow&&(a.io.send(lnn.onion.build(a,"sendme")),a.stream.packagewindow+=100);"data"==c.cmd&&--b.packagewindow;450>b.packagewindow&&(c=lnn.onion.build(a,"sendme",b.id),a.io.send(c),b.packagewindow+=50)}else console.log("Got cell outside stream, 'dropped': ",c.stream_id);--lnn.stream.entrancy};
lnn.stream.raw=function(a,c){var b={id:null,data:[],cell:null,send:function(c,e){var f=lnn.onion.build(b.endpoint,c,b.id,e);"data"!=c?a.io.send(f):0<b.deliverywindow?(a.stream.send(f,a),--b.deliverywindow):b.tosend.push(f)},recv:function(){var a=b.data;b.data=[];return a},state:lnn.state.started,packagewindow:null,deliverywindow:null,tosend:[],endpoint:a,callback:function(d){"connected"==d.cmd&&(b.state=lnn.state.created);"end"==d.cmd&&(b.state=lnn.state.success);if("sendme"==d.cmd)for(b.deliverywindow+=
50;0<b.deliverywindow&&0<b.tosend.length;)d=b.tosend.shift(),a.stream.send(d,a),--b.deliverywindow;b.data.push(d);c(b);"connected"==d.cmd&&(b.state=lnn.state.pending)}};a.stream.register(b);c(b);return b};
lnn.stream.dir=function(a,c,b){var d={id:null,data:"",cell:null,send:function(){throw"No send method on directory streams.";},recv:function(){var a=d.data;d.data="";return a},state:lnn.state.started,packagewindow:null,deliverywindow:null,tosend:[],endpoint:a,callback:function(c){"connected"==c.cmd&&(d.state=lnn.state.created,b(d),d.state=lnn.state.pending);"end"==c.cmd&&(d.state=lnn.state.success,b(d));if("sendme"==c.cmd)for(d.deliverywindow+=50;0<d.deliverywindow&&0<d.tosend.length;)c=d.tosend.shift(),
a.stream.send(c,a),--d.deliverywindow;"data"==c.cmd&&(d.data+=lnn.enc.utf8(c.data),b(d))}},e=a.stream.register(d),f=lnn.onion.build(a,"begin_dir",e);a.io.send(f);c="GET "+c+" HTTP/1.0\r\nAccept-Encoding: identity\r\n\r\n";c=lnn.dec.utf8(c);f=lnn.onion.build(a,"data",e,c);--d.deliverywindow;a.stream.send(f,a);b(d);return d};
lnn.stream.tcp=function(a,c,b,d){var e={id:null,data:new Uint8Array(0),cell:null,cache:[],send:function(a){void 0!==a&&e.cache.push(a);if(e.state!=lnn.state.started)for(;e.cache.length;){a=e.cache.shift();"string"==typeof a&&(a=lnn.dec.utf8(a));for(var b=new Uint8Array(lnn.relay.data_len);a.length>b.length;){b.set(a.slice(0,b.length),0);a=a.slice(b.length);var c=lnn.onion.build(e.endpoint,"data",e.id,b);0<e.deliverywindow?(e.endpoint.stream.send(c,e.endpoint),--e.deliverywindow):e.tosend.push(c)}c=
lnn.onion.build(e.endpoint,"data",e.id,a);0<e.deliverywindow?(e.endpoint.stream.send(c,e.endpoint),--e.deliverywindow):e.tosend.push(c)}},recv:function(){var a=e.data;e.data=new Uint8Array(0);return a},close:function(){var a=new Uint8Array(1);a[0]=6;a=lnn.onion.build(e.endpoint,"end",e.id,a);e.endpoint.io.send(a)},state:lnn.state.started,packagewindow:null,deliverywindow:null,tosend:[],endpoint:a,retries:0,callback:function(a){console.log(a.cmd);"connected"==a.cmd&&(e.state=lnn.state.created,e.retries=
0,e.send());if("end"==a.cmd)if(4==a.data[0])if(3==e.retries)console.log("Retries limit exceeded. Cant connect to host. "),e.state=lnn.state.success,e.retries=0;else{e.retries+=1;console.log("Retrying to build circuit, retry#: "+e.retries);var c=[80,443];c.includes(b)||c.push(b);lnn.open(e.endpoint.host,e.endpoint.port,e.success_on_open,e.error_on_open,void 0,e.endpoint.fast,e.endpoint.auth,e.endpoint.select_path,c)}else e.state=lnn.state.success;"data"==a.cmd&&(c=e.data,e.data=new Uint8Array(c.length+
a.data.length),e.data.set(c,0),e.data.set(a.data,c.length));if("sendme"==a.cmd)for(e.deliverywindow+=50;0<e.deliverywindow&&0<e.tosend.length;)a=e.tosend.shift(),e.endpoint.stream.send(a,e.endpoint),--e.deliverywindow;d(e);"connected"==a.cmd&&(e.state=lnn.state.pending)},success_on_open:function(a){null==a.consensus&&(a.consensus=e.endpoint.consensus);null==a.descriptors&&(a.descriptors=e.endpoint.descriptors);null==a.consensus_raw&&(a.consensus_raw=e.endpoint.consensus_raw);null==a.descriptors_raw&&
(a.descriptors_raw=e.endpoint.descriptors_raw);null==a.signing_keys&&(a.signing_keys=e.endpoint.signing_keys);e.endpoint=a;a=e.endpoint.stream.register(e);var f=lnn.relay.begin(c,b);a=lnn.onion.build(e.endpoint,"begin",a,f);e.endpoint.io.send(a);d(e)},error_on_open:function(a){throw a;}},f=a.stream.register(e),h=lnn.relay.begin(c,b),f=lnn.onion.build(a,"begin",f,h);a.io.send(f);d(e);return e};lnn.enc={};lnn.enc.bits=sjcl.codec.bytes.toBits;lnn.enc.utf8=nacl.util.encodeUTF8;lnn.enc.base64=nacl.util.encodeBase64;
lnn.enc.bin=function(a){for(var c="",b=0;b<a.length;b++)c+=String.fromCharCode(a[b]);return c};lnn.dec={};lnn.dec.bits=function(a){return new Uint8Array(sjcl.codec.bytes.fromBits(a))};lnn.dec.utf8=nacl.util.decodeUTF8;lnn.dec.base64=nacl.util.decodeBase64;lnn.dec.bin=function(a){for(var c=new Uint8Array(a.length),b=0;b<a.length;b++)c[b]=a.charCodeAt(b);return c};lnn.fast=function(a,c,b,d,e,f){void 0===f&&(f=!0);return lnn.open(a,c,b,d,e,!0,null,f)};
lnn.auth=function(a,c,b,d,e,f,h){void 0===h&&(h=!0);"string"==typeof b&&(b=b.replace(/-/g,"+").replace(/_/g,"/"),b=lnn.dec.base64(b));if("auth "!=lnn.enc.utf8(b.slice(0,5)))throw"Invalid prefix in auth. suffix!";b=b.slice(5);if(52!=b.length)throw"Invalid auth. suffix length!";return lnn.open(a,c,d,e,f,!0,{identity:b.slice(0,20),onionkey:b.slice(20),ntor:nacl.box.keyPair()},h)};
lnn.open=function(a,c,b,d,e,f,h,g,l){var k=lnn.endpoint(a,c);void 0===e&&(e=lnn.io.socket);void 0===f&&(f=!1);void 0===d&&(d=function(){});void 0===b&&(b=function(){});void 0===g&&(g=!0);void 0===l&&(l=[80,443]);k.fast=f;k.auth=h;k.select_path=g;var n={guard:function(a){a.state=lnn.state.guarded;lnn.post.circuit_info(a,n.startWebSocket,d,g,l)},startWebSocket:function(a,b){console.log("called startWebSocket cb");a.stream=lnn.stream.backend(d);e(a,lnn.stream.handler,function(a){var b=a.state;a.state=
lnn.state.pending;a.state=b},d);a.io.start();lnn.post.handshake(a,b,n.create,d)},create:function(a){console.log("called create cb");a.state=lnn.state.created;lnn.post.extend(a,a.path[0],n.extend,d)},extend:function(a){console.log("called extend cb");a.state=lnn.state.extpath;lnn.post.extend(a,a.path[1],n.success,d)},success:function(a){console.log("called success cb");a.state=lnn.state.success;b(a);a.io.success=function(){}}};k.state=lnn.state.started;g?lnn.get.consensus_raw(k,function(){lnn.get.signing_keys(k,
function(){if(!lnn.signature.verify(k.consensus_raw,k.signing_keys,.5))throw"signature verification failed.";console.log("signature verification success");lnn.get.descriptors_raw(k,function(){k.fast?lnn.post.circuit_info(k,n.startWebSocket,d,g,l):lnn.get.guard(k,n.guard,d)},function(){throw"Failed to fetch raw descriptors";})},function(){throw"Failed to fetch signing keys";})},function(){throw"Failed to fetch raw consensus!";}):k.fast?lnn.post.circuit_info(k,n.startWebSocket,d,g,l):lnn.get.guard(k,
n.guard,d);return k};lnn.agents="curl/7.61.0 curl/7.60.0 curl/7.59.0 curl/7.58.0 curl/7.57.0 curl/7.56.1 curl/7.56.0 curl/7.55.1 curl/7.55.0 curl/7.54.1 curl/7.54.0 curl/7.53.1 curl/7.53.0 curl/7.52.1 curl/7.52.0 curl/7.51.0 curl/7.50.3 curl/7.50.2 curl/7.50.1 curl/7.50.0 curl/7.50.0 curl/7.49.1 curl/7.49.0 curl/7.48.0 curl/7.47.1 curl/7.47.0 curl/7.46.0 curl/7.45.0 curl/7.44.0 curl/7.43.0 curl/7.42.1 curl/7.42.0 curl/7.41.0 curl/7.40.0 curl/7.39.0 curl/7.38.0".split(" ");
lnn.send_req=function(a,c,b,d,e,f,h){var g=lnn.agents[Math.floor(Math.random()*lnn.agents.length)],l="",k=null,n=0,q=null,A=function(a){if(a.state==lnn.state.success)h("Connection closed");else if(a.state==lnn.state.pending){var b=a.recv();n+=b.length;l+=lnn.enc.utf8(b);null==k&&l.match("\r\n\r\n")&&(q=l.split("\r\n\r\n")[0],b=q.match("Content-Length: ([^\r]*)"),k=parseInt(b[1]));null==q||null==k||n<q.length+k||(a.close(),console.log("Stream closed"),f({headers:q,data:l.slice(q.length+4)}),f=function(a){})}};
if("http://"==c.slice(0,7)){c=c.slice(7);var u="/"+c.split("/").slice(1).join("/"),x=null,x=null==c.match("/")?c:c.split("/",1)[0];c="80";null!=x.match(":")&&(c=x.split(":",2)[1]);"GET"!=b&&"POST"!=b?h("Unsupported method"):"json"!=e&&"form"!=e?h("Unsupported content type"):(e="json"==e?"application/json":"application/x-www-form-urlencoded","GET"==b&&0<d.length?(d="?"+d,u=encodeURI(u+d)):"application/x-www-form-urlencoded"==e&&(d=encodeURI(d)),g=[[b,u,"HTTP/1.1"].join(" "),["Host:",x].join(" "),["User-Agent:",
g].join(" "),"Accept: */*"],"POST"==b?(g.push(["Content-Length:",d.length].join(" ")),g.push(["Content-Type:",e].join(" ")),g=g.join("\r\n")+"\r\n\r\n"+d+"\r\n"):g=g.join("\r\n")+"\r\n\r\n",console.log(g),x=x.split(":")[0],lnn.stream.tcp(a,x,c,A).send(g))}else h("Urls must start with http://")};
lnn.http_request=function(a,c,b,d,e,f,h,g){void 0===h&&(h="localhost");void 0===g&&(g=4990);void 0===f&&(f=function(){});void 0===e&&(e=function(){});var l=!1;lnn.open(h,g,function(g){g.state==lnn.state.success&&lnn.send_req(g,a,c,b,d,function(a){l||(g.close(function(a){console.log(a)}),l=!0);e(a)},function(a){l||(g.close(function(a){console.log(a)}),l=!0);f(a)})},function(){f("Connection establishment failed")})};lnn.signature={};
lnn.signature.verify=function(a,c,b,d){d=void 0===d?"microdesc":d;if(void 0===b)b=.5;else if(0>=b||1<b)throw"The minimal percentage must be between 0 (not included) and 1";var e=0,f=0,h=a.split("directory-signature ");a=h[0]+"directory-signature ";a="unflavored"==d?sjcl.hash.sha1.hash(a):sjcl.hash.sha256.hash(a);a=sjcl.codec.hex.fromBits(a);var h=lnn.signature.get_sig_and_keys_digests(h.splice(1)),g;for(g in h){f++;var l=c[g];d=bigInt(l.exponent);var k=bigInt(l.modulus),n=h[g]["signing-key-digest"];
void 0!==l&&lnn.signature.verify_key(l.pem,n)&&(l=lnn.signature.get_signature_big_int(h[g].signature),d=lnn.signature.get_hash(l,d,k),d=lnn.signature.get_hash_from_rsa_cipher(d),e=void 0===d||d!==a?e:e+1)}return e>b*f};lnn.signature.get_hash=function(a,c,b){a=a.modPow(c,b).toString(16);b=b.toString(16).length-a.length;for(c=0;c<b;c++)a="0"+a;return a};
lnn.signature.verify_key=function(a,c){var b=a.split("\n"),d=b.indexOf("-----BEGIN RSA PUBLIC KEY-----"),e=b.indexOf("-----END RSA PUBLIC KEY-----"),b=b.splice(d+1,e-d-1).join(""),b=sjcl.codec.base64.toBits(b),b=sjcl.hash.sha1.hash(b),b=sjcl.codec.hex.fromBits(b);return b.toUpperCase()===c.toUpperCase()};
lnn.signature.get_sig_and_keys_digests=function(a){var c={};a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(b=b.value,""!==b){var d=b.split("\n"),b=d.indexOf("-----BEGIN SIGNATURE-----"),e=d.indexOf("-----END SIGNATURE-----"),b=d.splice(b+1,e-b-1).join(""),d=d[0].split(" "),e=$jscomp.makeIterator(2==d.length?d:d.splice(1)),d=e.next().value,e=e.next().value;c[d]={"signing-key-digest":e,signature:b}}return c};
lnn.signature.get_signature_big_int=function(a){a=sjcl.codec.hex.fromBits(sjcl.codec.base64.toBits(a));return bigInt(a,16)};lnn.signature.get_hash_from_rsa_cipher=function(a){if(a.startsWith("0001")){a=a.substring(4);for(var c=a.indexOf("00"),b=1;b<c;b++)if("f"!==a.charAt(b))return;return a.substring(c+2)}};lnn.consensusParser={};
lnn.consensusParser.parse=function(a,c){c=void 0===c?"microdesc":c;if("string"!==typeof a)throw"Error: the consensus must be given as a string";lnn.consensusParser.lines=a.split("\n");lnn.consensusParser.words=lnn.consensusParser.lines[0].split(" ");lnn.consensusParser.consensus={};lnn.consensusParser.validFlags="Authority BadExit Exit Fast Guard HSDir NoEdConsensus Stable StaleDesc Running Valid V2Dir".split(" ");lnn.consensusParser.index=0;lnn.consensusParser.totalLines=lnn.consensusParser.lines.length;
if("unflavored"!=c&&"microdesc"!=c)throw"Error: Unexpected flavor";lnn.consensusParser.consensus.flavor=c;lnn.consensusParser.consumeHeaders();lnn.consensusParser.consumeAuthority();lnn.consensusParser.consumeRouters();lnn.consensusParser.consumeFooter();return lnn.consensusParser.consensus};
lnn.consensusParser.consumeHeaders=function(){lnn.consensusParser.consumeNetworkStatusVersion();lnn.consensusParser.consumeVoteStatus();lnn.consensusParser.consumeConsensusMethod();lnn.consensusParser.consumeDate("valid-after");lnn.consensusParser.consumeDate("fresh-until");lnn.consensusParser.consumeDate("valid-until");lnn.consensusParser.consumeVotingDelay();lnn.consensusParser.tryConsumeVersions("client-versions");for(lnn.consensusParser.tryConsumeVersions("server-versions");"package"===lnn.consensusParser.words[0];)lnn.consensusParser.consumePackage();
lnn.consensusParser.consumeKnownFlags();lnn.consensusParser.tryConsumeProtocols("recommended-client-protocols");lnn.consensusParser.tryConsumeProtocols("recommended-relay-protocols");lnn.consensusParser.tryConsumeProtocols("required-client-protocols");lnn.consensusParser.tryConsumeProtocols("required-relay-protocols");lnn.consensusParser.tryConsumeParams();lnn.consensusParser.tryConsumeShareRand("shared-rand-previous-value");lnn.consensusParser.tryConsumeShareRand("shared-rand-current-value")};
lnn.consensusParser.consumeNetworkStatusVersion=function(){var a=2;if("microdesc"==lnn.consensusParser.consensus.flavor&&(a=3,"microdesc"!=lnn.consensusParser.words[2]))throw"Error: Flavor mismatch in header.";a=lnn.consensusParser.tryParseKeyValueInteger("network-status-version",a);lnn.consensusParser.consensus.headers={"network-status-version":{version:a,flavor:lnn.consensusParser.consensus.flavor}};lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeVoteStatus=function(){var a=lnn.consensusParser.tryParseKeyValueString("vote-status");if("consensus"!==a)throw"WrongParameterException: vote-status must be consensus";lnn.consensusParser.consensus.headers["vote-status"]=a;lnn.consensusParser.nextLine()};lnn.consensusParser.consumeConsensusMethod=function(){lnn.consensusParser.consensus.headers["consensus-method"]=lnn.consensusParser.tryParseKeyValueInteger("consensus-method");lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeDate=function(a){lnn.consensusParser.consensus.headers[a]=lnn.consensusParser.tryParseDate(a);lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeVotingDelay=function(){lnn.consensusParser.checkFormat(3,"voting-delay");if(isNaN(lnn.consensusParser.words[1]))throw"WrongParameterException: "+words[1]+" is not a number";if(isNaN(lnn.consensusParser.words[2]))throw"WrongParameterException: "+words[2]+" is not a number";lnn.consensusParser.consensus.headers["voting-delay"]={vote:Number(lnn.consensusParser.words[1]),dist:Number(lnn.consensusParser.words[2])};lnn.consensusParser.nextLine()};
lnn.consensusParser.tryConsumeVersions=function(a){if(void 0!==lnn.consensusParser.consensus.headers[a])throw"AlreadyPresentException: "+a+" can only appear once";lnn.consensusParser.words[0]===a&&(lnn.consensusParser.consensus.headers[a]=lnn.consensusParser.tryParseCommaSeparatedList(a),lnn.consensusParser.nextLine())};
lnn.consensusParser.consumePackage=function(){if(5>lnn.consensusParser.words.length)throw"WrongFormatException: at least 5 fields are expected";void 0===lnn.consensusParser.consensus.headers["package"]&&(lnn.consensusParser.consensus.headers["package"]=[]);for(var a={name:lnn.consensusParser.words[1],version:lnn.consensusParser.words[2],url:lnn.consensusParser.words[3]},c=lnn.consensusParser.words.splice(4,lnn.consensusParser.words.length),b={},c=$jscomp.makeIterator(c),d=c.next();!d.done;d=c.next())d=
d.value.split("="),b[d[0]]=d[1];a.digests=b;lnn.consensusParser.consensus.headers["package"].push(a);lnn.consensusParser.nextLine()};lnn.consensusParser.consumeKnownFlags=function(){lnn.consensusParser.consensus.headers.flags=lnn.consensusParser.tryParseFlags();lnn.consensusParser.nextLine()};
lnn.consensusParser.tryConsumeProtocols=function(a){if(void 0!==lnn.consensusParser.consensus.headers[a])throw"AlreadyPresentException: "+a+" can only appear once";lnn.consensusParser.words[0]===a&&(lnn.consensusParser.consensus.headers[a]=lnn.consensusParser.tryParseRanges(lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length)),lnn.consensusParser.nextLine())};
lnn.consensusParser.tryConsumeParams=function(){"params"===lnn.consensusParser.words[0]&&(lnn.consensusParser.consensus.headers.params=lnn.consensusParser.tryParseParams(),lnn.consensusParser.nextLine())};
lnn.consensusParser.tryConsumeShareRand=function(a){if(void 0!==lnn.consensusParser.consensus.headers[a])throw"AlreadyPresentException: "+a+" can only appear once";if(lnn.consensusParser.words[0]===a){var c=Number(lnn.consensusParser.words[1]),b=lnn.consensusParser.words[2];if(!lnn.consensusParser.isBase64(b))throw"InvalidParameterException: value "+b+" must be in hexadecimal";lnn.consensusParser.consensus.headers[a]={NumReveals:c,Value:b};lnn.consensusParser.nextLine()}};
lnn.consensusParser.consumeAuthority=function(){if("dir-source"!==lnn.consensusParser.words[0])throw"WrongFieldException: there must be at least one dir-source";for(lnn.consensusParser.consensus["dir-sources"]=[];"dir-source"===lnn.consensusParser.words[0];)lnn.consensusParser.consumeDirSource()};
lnn.consensusParser.consumeDirSource=function(){var a={};lnn.consensusParser.checkFormat(7,"dir-source");a.nickname=lnn.consensusParser.words[1];if(!lnn.consensusParser.isHex(lnn.consensusParser.words[2]))throw"InvalidParameterException: vote-digest "+lnn.consensusParser.words[2]+" must be in hexadecimal";a.identity=lnn.consensusParser.words[2].toUpperCase();a.hostname=lnn.consensusParser.words[3];if(!lnn.consensusParser.isValidIP(lnn.consensusParser.words[4]))throw"InvalidIPException: "+lnn.consensusParser.words[4]+
" is not a valid IP";a.address=lnn.consensusParser.words[4];if(!lnn.consensusParser.isValidPort(Number(lnn.consensusParser.words[5]))||!lnn.consensusParser.isValidPort(Number(lnn.consensusParser.words[6])))throw"InvalidPortException";a.dirport=Number(lnn.consensusParser.words[5]);a.orport=Number(lnn.consensusParser.words[6]);lnn.consensusParser.nextLine();a.contact=lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length).join(" ");lnn.consensusParser.nextLine();var c=lnn.consensusParser.tryParseKeyValueString("vote-digest").toUpperCase();
if(!lnn.consensusParser.isHex(c))throw"InvalidParameterException: vote-digest "+c+" must be in hexadecimal";a["vote-digest"]=c;lnn.consensusParser.consensus["dir-sources"].push(a);lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeRouters=function(){if("r"!==lnn.consensusParser.words[0])throw"WrongFieldException: there must be at least one router";for(lnn.consensusParser.consensus.routers=[];"r"===lnn.consensusParser.words[0];){var a={};lnn.consensusParser.consumeRfield(a);for("a"===lnn.consensusParser.words[0]&&(a.a=[]);"a"===lnn.consensusParser.words[0];)lnn.consensusParser.consumeAfield(a);"microdesc"==lnn.consensusParser.consensus.flavor&&lnn.consensusParser.consumeMfield(a);lnn.consensusParser.consumeSfield(a);
lnn.consensusParser.tryConsumeVfield(a);lnn.consensusParser.tryConsumePrField(a);lnn.consensusParser.tryConsumeWfield(a);lnn.consensusParser.tryConsumePfield(a);lnn.consensusParser.consensus.routers.push(a)}};
lnn.consensusParser.consumeRfield=function(a){var c=9;"microdesc"==lnn.consensusParser.consensus.flavor&&(c=8);lnn.consensusParser.checkFormat(c,"r");a.nickname=lnn.consensusParser.words[1];if(!lnn.consensusParser.isBase64(lnn.consensusParser.words[2]+"="))throw"InvalidParameterException: identity "+lnn.consensusParser.words[2]+" must be in base64";a.identity=lnn.consensusParser.words[2];c=3;if("unflavored"==lnn.consensusParser.consensus.flavor){if(!lnn.consensusParser.isBase64(lnn.consensusParser.words[3]+
"="))throw"InvalidParameterException: digest "+lnn.consensusParser.words[3]+" must be in base64";a.digest=lnn.consensusParser.words[3];c+=1}if(!lnn.consensusParser.isValidDate(lnn.consensusParser.words[c]))throw"InvalidParameterException: date "+lnn.consensusParser.words[c]+" must have the format YYYY-MM-DD";a.date=lnn.consensusParser.words[c];if(!lnn.consensusParser.isValidTime(lnn.consensusParser.words[c+1]))throw"InvalidParameterException: time "+lnn.consensusParser.words[c+1]+" must have the format HH:MM:SS";
a.time=lnn.consensusParser.words[c+1];if(!lnn.consensusParser.isValidIP(lnn.consensusParser.words[c+2]))throw"InvalidParameterException: IP "+lnn.consensusParser.words[c+2]+" must be a valid IP address";a.address=lnn.consensusParser.words[c+2];if(!lnn.consensusParser.isValidPort(Number(lnn.consensusParser.words[c+3])))throw"InvalidParameterException: ORPort "+lnn.consensusParser.words[c+3]+" must be a valid port";a.orport=Number(lnn.consensusParser.words[c+3]);if(!lnn.consensusParser.isValidPort(Number(lnn.consensusParser.words[c+
4])))throw"InvalidParameterException: DirPort "+lnn.consensusParser.words[c+4]+" must be a valid port";a.dirport=Number(lnn.consensusParser.words[c+4]);lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeAfield=function(a){var c=lnn.consensusParser.words[1].indexOf("]"),c=lnn.consensusParser.words[1].slice(1,c);if(!lnn.consensusParser.isValidIP(c))throw"InvalidParameterException: IP "+c+" must be a valid IP address";var b="IPv6";lnn.consensusParser.isIPv4(c)&&(b="IPv4");var d=Number(lnn.consensusParser.words[1].slice(c.length+3,lnn.consensusParser.words[1].length));if(!lnn.consensusParser.isValidPort(d))throw"InvalidParameterException: port "+d+" must be a valid port";a.a.push({ip:c,
port:d,type:b});lnn.consensusParser.nextLine()};lnn.consensusParser.consumeSfield=function(a){a.flags=lnn.consensusParser.tryParseFlags();lnn.consensusParser.nextLine()};lnn.consensusParser.tryConsumeVfield=function(a){"v"===lnn.consensusParser.words[0]&&(lnn.consensusParser.checkFormat(3,"v"),a.version=lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length).join(" "),lnn.consensusParser.nextLine())};
lnn.consensusParser.tryConsumePrField=function(a){"pr"===lnn.consensusParser.words[0]&&(a.protocols=lnn.consensusParser.tryParseRanges(lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length)),lnn.consensusParser.nextLine())};lnn.consensusParser.tryConsumeWfield=function(a){"w"===lnn.consensusParser.words[0]&&(a.w=lnn.consensusParser.tryParseParams(),lnn.consensusParser.nextLine())};
lnn.consensusParser.tryConsumePfield=function(a){if("p"===lnn.consensusParser.words[0]){lnn.consensusParser.checkFormat(3,"p");if("accept"!==lnn.consensusParser.words[1]&&"reject"!==lnn.consensusParser.words[1])throw"WrongParameterException: "+lnn.consensusParser.words[1]+" must be either accept or reject";var c=lnn.consensusParser.parse_range_once(lnn.consensusParser.words[2]);a["exit-policy"]={type:lnn.consensusParser.words[1],PortList:c};lnn.consensusParser.nextLine()}};
lnn.consensusParser.consumeMfield=function(a){lnn.consensusParser.checkFormat(2,"m");if(!lnn.consensusParser.isBase64(lnn.consensusParser.words[1]+"="))throw"InvalidParameterException: digest "+lnn.consensusParser.words[1]+" must be in base64";a["micro-digest"]=lnn.consensusParser.words[1];lnn.consensusParser.nextLine()};
lnn.consensusParser.consumeFooter=function(){if("directory-footer"!==lnn.consensusParser.words[0])throw"WrongFieldException: there must be a footer";lnn.consensusParser.nextLine();lnn.consensusParser.consensus.footer={};lnn.consensusParser.tryConsumeBandwidthWeights();if("directory-signature"!==lnn.consensusParser.words[0])throw"WrongFieldException: there must be at least one signature";for(lnn.consensusParser.consensus.footer["directory-signatures"]=[];"directory-signature"===lnn.consensusParser.words[0];)lnn.consensusParser.consensus.footer["directory-signatures"].push(lnn.consensusParser.consumeSignature())};
lnn.consensusParser.tryConsumeBandwidthWeights=function(){"bandwidth-weights"===lnn.consensusParser.words[0]&&(lnn.consensusParser.consensus.footer["bandwidth-weights"]=lnn.consensusParser.tryParseParams(),lnn.consensusParser.nextLine())};
lnn.consensusParser.consumeSignature=function(){if("directory-signature"!==lnn.consensusParser.words[0])throw"WrongFieldException: next field must be directory-signature";var a=lnn.consensusParser.words.length,c=void 0,b=void 0;if(4===a)c=lnn.consensusParser.words[1],b=lnn.consensusParser.words.splice(2,a);else if(3===a)c="sha1",b=lnn.consensusParser.words.splice(1,a);else throw"WrongParameterException: directory-signature has 3 or 4 arguments";a=b[0];if(!lnn.consensusParser.isHex(a))throw"InvalidParameterException: the identity "+
a+" must be in hexadecimal";b=b[1];if(!lnn.consensusParser.isHex(b))throw"InvalidParameterException: the signing-key-digest "+b+" must be in hexadecimal";lnn.consensusParser.nextLine();var d=lnn.consensusParser.parseSignature();lnn.consensusParser.index<lnn.consensusParser.totalLines-1&&lnn.consensusParser.nextLine();return{Algorithm:c,identity:a,"signing-key-digest":b,signature:d}};
lnn.consensusParser.tryParseKeyValueInteger=function(a,c){lnn.consensusParser.checkFormat(void 0===c?2:c,a);if(isNaN(lnn.consensusParser.words[1]))throw"WrongParameterException: "+lnn.consensusParser.words[1]+" is not a number";return Math.floor(lnn.consensusParser.words[1])};lnn.consensusParser.tryParseKeyValueString=function(a){lnn.consensusParser.checkFormat(2,a);return lnn.consensusParser.words[1]};
lnn.consensusParser.tryParseDate=function(a){lnn.consensusParser.checkFormat(3,a);if(!lnn.consensusParser.isValidDate(lnn.consensusParser.words[1]))throw"NonValidDateException: "+lnn.consensusParser.words[1]+" is not a valid date";if(!lnn.consensusParser.isValidTime(lnn.consensusParser.words[2]))throw"NonValidTimeException: "+lnn.consensusParser.words[2]+" is not a valid time";return{date:lnn.consensusParser.words[1],time:lnn.consensusParser.words[2]}};
lnn.consensusParser.tryParseCommaSeparatedList=function(a){lnn.consensusParser.checkFormat(2,a);return lnn.consensusParser.words[1].split(",")};lnn.consensusParser.tryParseRanges=function(a){var c={};a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,b.includes("=")&&(b=b.split("="),c[b[0]]=lnn.consensusParser.parse_range_once(b[1]));return c};
lnn.consensusParser.parse_range_once=function(a){a=a.split(",");var c=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())if(b=b.value,b.includes("-")){var d=b.split("-"),b=Number(d[0]),d=Number(d[1]);b===d-1?c.push([b,d]):c.push([[b,d]])}else c.push([Number(b)]);return c};
lnn.consensusParser.tryParseFlags=function(){for(var a=lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length),c=$jscomp.makeIterator(a),b=c.next();!b.done;b=c.next())if(b=b.value,!lnn.consensusParser.validFlags.includes(b))throw"NotValidFlagException: "+b+" is not a valid flag";return a};
lnn.consensusParser.parseSignature=function(){if("-----BEGIN"!==lnn.consensusParser.words[0])throw"WrongFormatException";lnn.consensusParser.nextLine();for(var a="";"-----END SIGNATURE-----"!==lnn.consensusParser.lines[lnn.consensusParser.index];)a+=lnn.consensusParser.lines[lnn.consensusParser.index],lnn.consensusParser.nextLine();return a};
lnn.consensusParser.tryParseParams=function(){for(var a={},c=$jscomp.makeIterator(lnn.consensusParser.words.splice(1,lnn.consensusParser.words.length)),b=c.next();!b.done;b=c.next())b=b.value.split("="),a[b[0]]=Number(b[1]);return a};lnn.consensusParser.isValidDate=function(a){return"string"!==typeof a?!1:/^\d{4}[-](0[1-9]|1[012])[-](0[1-9]|[12][0-9]|3[01])$/.test(a)};lnn.consensusParser.isValidTime=function(a){return"string"!==typeof a?!1:/^(0[0-9]|1[0-9]|2[0-3])[:][0-5][0-9][:][0-5][0-9]$/.test(a)};
lnn.consensusParser.isValidIP=function(a){return/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$|^(([a-zA-Z]|[a-zA-Z][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z]|[A-Za-z][A-Za-z0-9\-]*[A-Za-z0-9])$|^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(a)};
lnn.consensusParser.isIPv4=function(a){return/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)};lnn.consensusParser.isValidPort=function(a){return isNaN(a)?!1:0<=a&&0xffff>=a};lnn.consensusParser.isHex=function(a){return/^[a-fA-F0-9]+$/.test(a)};lnn.consensusParser.isBase64=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)};
lnn.consensusParser.nextLine=function(){if(lnn.consensusParser.index>=lnn.consensusParser.totalLines)throw"EndOfFileException: there are no lines to parse";lnn.consensusParser.words=lnn.consensusParser.lines[++lnn.consensusParser.index].split(" ")};
lnn.consensusParser.checkFormat=function(a,c){if(lnn.consensusParser.words.length!=a)throw"WrongFormatException: "+a+" fields are expected";if(lnn.consensusParser.words[0]!=c)throw"NotEqualException:b "+c+" is not equal to "+lnn.consensusParser.words[0];};lnn.parser={};
lnn.parser.descriptors={line_count:0,total_lines:-1,lines:void 0,valid_bridge_distribution:"none any https email moat hyphae".split(" "),exactly_once:"router bandwidth published onion-key signing-key router-signatures".split(" "),exactly_once_mic:["onion-key","policy","ipv6-policy"],parse:function(a,c){c=void 0===c?"microdesc":c;if("unflavored"!=c&&"microdesc"!=c)throw"Error: Unexpected flavor";var b=[];lnn.parser.descriptors.lines=a.split("\n");lnn.parser.descriptors.line_count=0;lnn.parser.descriptors.total_lines=
lnn.parser.descriptors.lines.length;for(lnn.parser.descriptors.flavor=c;lnn.parser.descriptors.line_count<lnn.parser.descriptors.total_lines;)if(""===lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count])lnn.parser.descriptors.line_count++;else{var d=lnn.parser.descriptors.consume_one_node();d.flavor=c;b.push(d)}return b},validate:function(a,c,b,d){d=void 0===d?!1:d;var e="unflavored"==(void 0===b?"microdesc":b)?"digest":"micro-digest";b=[];for(idx=0;idx<c.routers.length;idx++)b.push(c.routers[idx][e]);
c=[];for(idx=0;idx<a.length;idx++)c.push(a[idx][e]);a=[];console.log(c.length);for(idx=0;idx<b.length;idx++)e=b[idx],c.includes(e)?c.splice(c.indexOf(e),1):a.push(e);console.log(c.length);if(c.length)throw"Invalid descriptors found";if(d&&0<a.length)throw"Failed to obtain some descriptors";}};var tot=0;
lnn.parser.descriptors.consume_one_node=function(){lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].startsWith("@type")&&lnn.parser.descriptors.line_count++;""===lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count]&&lnn.parser.descriptors.line_count++;var a={},c=lnn.parser.descriptors.line_count;"unflavored"==lnn.parser.descriptors.flavor?(a=lnn.parser.descriptors.consume_router(a),a=lnn.parser.descriptors.try_consume_identity_ed25519(a)):a=lnn.parser.descriptors.consume_onion_key(a);
for(var b=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count];;){if("unflavored"==lnn.parser.descriptors.flavor){if(b.startsWith("router-signature"))break}else if(lnn.parser.descriptors.line_count==lnn.parser.descriptors.total_lines||b.startsWith("@type")||b.startsWith("onion-key"))break;var d=b.indexOf(" ");switch(-1===d?b:b.substring(0,d)){case "master-key-ed25519":a=lnn.parser.descriptors.consume_master_key_ed25519(a);break;case "platform":a=lnn.parser.descriptors.consume_platform(a);
break;case "published":a=lnn.parser.descriptors.consume_published(a);break;case "bandwidth":a=lnn.parser.descriptors.consume_bandwidth(a);break;case "fingerprint":a=lnn.parser.descriptors.consume_fingerprint(a);break;case "hibernating":a=lnn.parser.descriptors.consume_hibernating(a);break;case "uptime":a=lnn.parser.descriptors.consume_uptime(a);break;case "extra-info-digest":a=lnn.parser.descriptors.consume_extra_info_digest(a);break;case "caches-extra-info":a=lnn.parser.descriptors.consume_single_word_line("caches-extra-info",
a);break;case "onion-key":a=lnn.parser.descriptors.consume_onion_key(a);break;case "onion-key-crosscert":a=lnn.parser.descriptors.consume_onion_key_crosscert(a);break;case "ntor-onion-key":a=lnn.parser.descriptors.consume_base64_digest("ntor-onion-key",a);break;case "ntor-onion-key-crosscert":a=lnn.parser.descriptors.consume_ntor_onion_key_crosscert(a);break;case "accept":a=lnn.parser.descriptors.consume_exit_policy("accept",a);break;case "reject":a=lnn.parser.descriptors.consume_exit_policy("reject",
a);break;case "signing-key":a=lnn.parser.descriptors.consume_signing_key(a);break;case "ipv6-policy":a=lnn.parser.consume_exit_policy("ipv6-policy",lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count++,a);break;case "router-sig-ed25519":a=lnn.parser.descriptors.consume_router_sig_ed25519(a);break;case "contact":a=lnn.parser.consume_contact(lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count++,a);break;case "bridge-distribution":a=lnn.parser.descriptors.consume_bridge_distribution(a);
break;case "family":a=lnn.parser.descriptors.consume_family(a);break;case "read-history":a=lnn.parser.descriptors.consume_history("read",a);break;case "write-history":a=lnn.parser.descriptors.consume_history("write",a);break;case "eventdns":a=lnn.parser.descriptors.consume_eventdns(a);break;case "hidden-service-dir":a=lnn.parser.descriptors.consume_single_word_line("hidden-service-dir",a);break;case "allow-single-hop-exits":a=lnn.parser.descriptors.consume_single_word_line("allow-single-hop-exits",
a);break;case "tunnelled-dir-server":a=lnn.parser.descriptors.consume_single_word_line("tunnelled-dir-server",a);break;case "proto":a=lnn.parser.consume_proto("proto",lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count++,a);break;case "p":a=lnn.parser.consume_exit_policy("p",lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count++,a);break;case "p6":a=lnn.parser.consume_exit_policy("p6",lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count++,a);break;case "id":a=lnn.parser.descriptors.consume_id(a);
break;default:++lnn.parser.descriptors.line_count}b=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count]}void 0===a["ipv6-policy"]&&(a["ipv6-policy"]={type:"reject",PortList:[[1,0xffff]]});void 0===a.policy&&(a.policy={type:"reject",PortList:[[1,0xffff]]});d=lnn.parser.descriptors.exactly_once_mic;b=lnn.parser.descriptors.line_count;"unflavored"==lnn.parser.descriptors.flavor&&(b+=1,a=lnn.parser.descriptors.consume_router_signature(a),d=lnn.parser.descriptors.exactly_once);if(!lnn.parser.descriptors.check_exactly_once(a,
d))throw"Invalid descriptor: some mandatory fields are not present";d="";for(i=c;i<b;i++)""!=lnn.parser.descriptors.lines[i]&&(d+=lnn.parser.descriptors.lines[i]+"\n");if("unflavored"==lnn.parser.descriptors.flavor){c=sjcl.hash.sha1.hash(d);for(c=lnn.enc.base64(lnn.dec.bits(c));0<c.length&&"="==c[c.length-1];)c=c.slice(0,-1);a.digest=c}else{c=sjcl.hash.sha256.hash(d);c=lnn.dec.bits(c);for(c=lnn.enc.base64(c);0<c.length&&"="==c[c.length-1];)c=c.slice(0,-1);a["micro-digest"]=c}return a};
lnn.parser.descriptors.check_exactly_once=function(a,c){void 0===a["ipv6-policy"]&&a;var b=!0;return(b=void 0!==a["identity-ed25519"]?void 0!==a["ntor-onion-key-crosscert"]&&void 0!==a["onion-key-crosscert"]&&void 0!==a["router-sig-ed25519"]:void 0===a["router-sig-ed25519"])&&c.every(function(b){return void 0!==a[b]})};
lnn.parser.descriptors.consume_router=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");lnn.parser.check_format(6,"router",c);if(!lnn.parser.is_valid_nickname(c[1]))throw"Invalid nickname: "+c[1]+" contains non-alphanumeric characters";if(!lnn.parser.is_valid_ipv4(c[2]))throw"Invalid address: "+c[2]+" is not a valid iPv4 address";if(!lnn.parser.is_valid_port(c[3]))throw"Invalid port: "+c[3]+" is not a valid port (0 to 0xffff)";if(!lnn.parser.is_valid_port(c[4]))throw"Invalid port: "+
c[4]+" is not a valid port (0 to 0xffff)";if(!lnn.parser.is_valid_port(c[5]))throw"Invalid port: "+c[5]+" is not a valid port (0 to 0xffff)";a.router={nickname:c[1],address:c[2],orport:Number(c[3]),socksport:Number(c[4]),dirport:Number(c[5])};++lnn.parser.descriptors.line_count;return a};
lnn.parser.descriptors.try_consume_identity_ed25519=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");if("identity-ed25519"===c[0]){lnn.parser.check_format(1,"identity-ed25519",c);++lnn.parser.descriptors.line_count;var b=$jscomp.makeIterator(lnn.parser.consume_pem(lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count)),c=b.next().value,b=b.next().value;lnn.parser.descriptors.line_count+=c+1;a.identity={type:"ed25519",cert:b}}return a};
lnn.parser.descriptors.consume_id=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");lnn.parser.check_format(3,"id",c);var b=c[1];if("rsa1024"!=b&&"ed25519"!=b)throw"Unexpected identity type  "+b;lnn.parser.check_reused("identity",a);if(!lnn.parser.is_valid_base64(lnn.parser.add_ending(c[2])))throw"Invalid master key: the master key "+c[2]+" must be in base64";a.identity={type:b,"master-key":c[2]};++lnn.parser.descriptors.line_count;return a};
lnn.parser.descriptors.consume_master_key_ed25519=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");lnn.parser.check_format(2,"master-key-ed25519",c);lnn.parser.check_reused("master-key-ed25519",a);var b=c[1];if(!lnn.parser.is_valid_base64(lnn.parser.add_ending(b)))throw"Invalid master key: the master key "+c[1]+" must be in base64";a.identity["master-key"]=b;lnn.parser.descriptors.line_count++;return a};
lnn.parser.descriptors.consume_platform=function(a){lnn.parser.check_reused("platform",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].substring(9);a.platform=c;lnn.parser.descriptors.line_count++;return a};lnn.parser.descriptors.consume_published=function(a){lnn.parser.check_reused("published",a);a.published=lnn.parser.consume_date("published",lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count]);++lnn.parser.descriptors.line_count;return a};
lnn.parser.descriptors.consume_bandwidth=function(a){lnn.parser.check_reused("bandwidth",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(4,"bandwidth",c);var b=Number(c[1]),d=Number(c[2]),c=Number(c[3]);if(0>b||0>d||0>c)throw"Invalid bandwidth: must be non-negative";a.bandwidth={avg:b,burst:d,observed:c};return a};
lnn.parser.descriptors.consume_fingerprint=function(a){lnn.parser.check_reused("fingerprint",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++],b=c.indexOf(" "),c=c.substring(b+1),b=c.split(" "),d=b.join("");if(10!=b.length)throw"Invalid fingerprint: wrong size";if(!lnn.parser.is_valid_hex(d))throw"Invalid fingerprint: not a hex string";b=sjcl.codec.hex.toBits(d);b=sjcl.codec.base64.fromBits(b).replace("=","");a.fingerprint=c;a.router.identity=b;return a};
lnn.parser.descriptors.consume_hibernating=function(a){lnn.parser.check_reused("hibernating",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,"hibernating",c);c=Number(c[1]);if(0!==c&&1!==c)throw"Invalid boolean";a.hibernating=c;return a};
lnn.parser.descriptors.consume_uptime=function(a){lnn.parser.check_reused("uptime",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,"uptime",c);c=Number(c[1]);if(0>c)throw"Invalid uptime: uptime must be non-negative";a.uptime=c;return a};
lnn.parser.descriptors.consume_onion_key=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");lnn.parser.check_reused("onion-key",a);lnn.parser.check_format(1,"onion-key",c);return lnn.parser.descriptors.consume_key("onion-key",a)};
lnn.parser.descriptors.consume_extra_info_digest=function(a){lnn.parser.check_reused("extra-info-digest",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");if(2!=c.length&&3!=c.length)throw"Invalid format: 1 or 2 fields are expected";var b=c[1];if(!lnn.parser.is_valid_hex(b))throw"Invalid encoding: the sha1 digest must be in hexadecimal";a["extra-info-digest"]={sha1:b};if(3===c.length){c=c[2];if(!lnn.parser.is_valid_base64(lnn.parser.add_ending(c)))throw"Invalid encoding: the sha256 digest must base 64";
a["extra-info-digest"].sha256=c}return a};lnn.parser.descriptors.consume_single_word_line=function(a,c){lnn.parser.check_reused(a,c);c[a]="true";++lnn.parser.descriptors.line_count;return c};lnn.parser.descriptors.consume_onion_key_crosscert=function(a){lnn.parser.check_reused("onion-key-crosscert",a);return lnn.parser.descriptors.consume_key("onion-key-crosscert",a)};
lnn.parser.descriptors.consume_ntor_onion_key_crosscert=function(a){lnn.parser.check_reused("ntor-onion-key-crosscert",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");lnn.parser.check_format(2,"ntor-onion-key-crosscert",c);c=Number(c[1]);if(0!=c&&1!=c)throw"Invalid bit for ntor-onion-key-crosscert";var b=$jscomp.makeIterator(lnn.parser.consume_pem(lnn.parser.descriptors.lines,++lnn.parser.descriptors.line_count)),d=b.next().value,b=b.next().value;lnn.parser.descriptors.line_count+=
d+1;a["ntor-onion-key-crosscert"]={bit:c,cert:b};return a};lnn.parser.descriptors.consume_router_sig_ed25519=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,"router-sig-ed25519",c);lnn.parser.check_reused("router-signatures",a);c=c[1];if(!lnn.parser.is_valid_base64(lnn.parser.add_ending(c)))throw"Invalid digest: must be a base 64 string";a["router-signatures"]={ed25519:c};return a};
lnn.parser.descriptors.consume_router_signature=function(a){var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count].split(" ");if("router-signature"===c[0]){lnn.parser.check_format(1,"router-signature",c);++lnn.parser.descriptors.line_count;var b=$jscomp.makeIterator(lnn.parser.consume_pem(lnn.parser.descriptors.lines,lnn.parser.descriptors.line_count)),c=b.next().value,b=b.next().value;lnn.parser.descriptors.line_count+=c+1;void 0===a["router-signatures"]&&(a["router-signatures"]={});
a["router-signatures"].rsa=b;return a}};lnn.parser.descriptors.consume_bridge_distribution=function(a){lnn.parser.check_reused("bridge-distribution",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,"bridge-distribution",c);c=c[1];lnn.parser.descriptors.valid_bridge_distribution.includes(c)||(c="none");a["bridge-distribution"]=c;return a};
lnn.parser.descriptors.consume_family=function(a){lnn.parser.check_reused("family",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ").splice(1);a.family=c;return a};
lnn.parser.descriptors.consume_history=function(a,c){var b=a+"-history";lnn.parser.check_reused(b,c);var d=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(6,a+"-history",d);var e=d[1];if(!lnn.parser.is_valid_date(e))throw"Invalid date";var f=d[2];if(!lnn.parser.is_valid_time(f))throw"Invalid time";var h=Number(d[3].substring(1)),d=d[5].split(",").map(function(a){return Number(a)});c[b]={date:e,time:f,interval:h,bytes:d};return c};
lnn.parser.descriptors.consume_eventdns=function(a){lnn.parser.check_reused("eventdns",a);var c=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,"eventdns",c);c=Number(c[1]);if(0!=c&&1!=c)throw"Invalid boolean";decriptor.eventdns=c;return a};
lnn.parser.descriptors.consume_base64_digest=function(a,c){var b=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,a,b);lnn.parser.check_reused(a,c);b=b[1];if(!lnn.parser.is_valid_base64(lnn.parser.add_ending(b)))throw"Invalid digest: must be a base 64 string";c[a]=b;return c};lnn.parser.descriptors.consume_signing_key=function(a){lnn.parser.check_reused("signing-key",a);return lnn.parser.descriptors.consume_key("signing-key",a)};
lnn.parser.descriptors.consume_exit_policy=function(a,c){var b=lnn.parser.descriptors.lines[lnn.parser.descriptors.line_count++].split(" ");lnn.parser.check_format(2,a,b);void 0===c.policy&&(c.policy={type:"exitpattern",rules:[]});c.policy.rules.push({type:a,pattern:b[1]});return c};
lnn.parser.descriptors.consume_key=function(a,c){var b=$jscomp.makeIterator(lnn.parser.consume_pem(lnn.parser.descriptors.lines,++lnn.parser.descriptors.line_count));offset=b.next().value;key=b.next().value;lnn.parser.descriptors.line_count+=offset+1;c[a]=key;return c};lnn.parser.check_format=function(a,c,b){if(b.length!=a)throw"wrong_format_exception: "+a+" fields are expected";if(b[0]!==c)throw"not_equal_exception: "+c+" is not equal to "+b[0];};lnn.parser.is_valid_ipv4=function(a){return/^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(a)};
lnn.parser.is_valid_port=function(a){return isNaN(a)?!1:0<=a&&0xffff>=a};lnn.parser.is_valid_nickname=function(a){return/^[a-z0-9]+$/i.test(a)};lnn.parser.is_valid_base64=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)};lnn.parser.is_valid_hex=function(a){return/^[a-fA-F0-9]+$/.test(a)};
lnn.parser.consume_pem=function(a,c){var b=0,d="";if(!a[c].startsWith("-----BEGIN"))throw'Invalid signature, certificate or key: must begin with "-----BEGIN"';for(b++;!a[c+b].startsWith("-----END");)d+=a[c+b],b++;if(!lnn.parser.is_valid_base64(d))throw"Invalid PEM: must be in base 64";return[b,d]};lnn.parser.parse_range=function(a){var c={};a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,b.includes("=")&&(b=b.split("="),c[b[0]]=lnn.parser.parse_range_once(b[1]));return c};
lnn.parser.parse_range_once=function(a){a=a.split(",");var c=[];a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,b.includes("-")?(b=b.split("-"),c.push([Number(b[0]),Number(b[1])])):c.push([Number(b)]);return c};
lnn.parser.consume_exit_policy=function(a,c,b,d){lnn.parser.check_reused(a,d);b=c[b].split(" ");lnn.parser.check_format(3,a,b);c=b[1];if("accept"!==c&&"reject"!==c)throw"Invalid policy: policy must either be accept or reject";b=lnn.parser.parse_range_once(b[2]);"p"==a&&(a="policy");"p6"==a&&(a="ipv6-policy");d[a]={type:c,PortList:b};return d};lnn.parser.consume_contact=function(a,c,b){lnn.parser.check_reused("contact",b);a=a[c].substring(8);b.contact=a;return b};
lnn.parser.is_valid_date=function(a){return"string"!==typeof a?!1:/^\d{4}[-](0[1-9]|1[012])[-](0[1-9]|[12][0-9]|3[01])$/.test(a)};lnn.parser.is_valid_time=function(a){return"string"!==typeof a?!1:/^(0[0-9]|1[0-9]|2[0-3])[:][0-5][0-9][:][0-5][0-9]$/.test(a)};
lnn.parser.consume_date=function(a,c){var b=c.split(" ");lnn.parser.check_format(3,a,b);if(!lnn.parser.is_valid_date(b[1]))throw"Invalid date: "+b[1]+" is not a valid date";if(!lnn.parser.is_valid_time(b[2]))throw"Invalid time: "+b[2]+" is not a valid time";return{date:b[1],time:b[2]}};lnn.parser.consume_proto=function(a,c,b,d){lnn.parser.check_reused(a,d);c=c[b].split(" ").splice(1);d[a]=lnn.parser.parse_range(c);return d};
lnn.parser.check_reused=function(a,c){if(void 0!==c[a])throw"The field "+a+" appears more than once";};lnn.parser.add_ending=function(a){if(0!==a.length%4)for(var c=a.length%4,b=0;b<4-c;b++)a+="=";return a};lnn.path={};
lnn.path.select=function(a,c,b){lnn.path.isChutney=void 0===b?!1:b;lnn.path.descriptorsMap={};c=$jscomp.makeIterator(c);for(b=c.next();!b.done;b=c.next())b=b.value,lnn.path.descriptorsMap[b.router.identity]=b;lnn.path.consensus=a.routers.filter(function(a){return lnn.path.obeyMinimalConstraints(a)});lnn.path.exit=lnn.path.chooseGoodExit(a);lnn.path.guard=lnn.path.chooseGoodGuard(a);lnn.path.middle=lnn.path.chooseGoodMiddle(a);return[lnn.path.guard,lnn.path.middle,lnn.path.exit]};
lnn.path.select_end_path=function(a,c,b,d,e){lnn.path.isChutney=void 0===d?!1:d;d={};for(var f=$jscomp.makeIterator(a.routers),h=f.next();!h.done;h=f.next())h=h.value,d[h["micro-digest"]]=h;lnn.path.descriptorsMap={};f=$jscomp.makeIterator(c);for(h=f.next();!h.done;h=f.next())h=h.value,h.router=d[h["micro-digest"]],h.bandwidth={},h.bandwidth.avg=h.router.w.Bandwidth,lnn.path.descriptorsMap[h.router.identity]=h;console.log(a.routers.length);console.log(c.length);lnn.path.consensus=a.routers.filter(function(a){return lnn.path.obeyMinimalConstraints(a)});
console.log(lnn.path.consensus.length);lnn.path.guard=b;lnn.path.exit=lnn.path.chooseGoodExitGivenGuard(e);lnn.path.middle=lnn.path.chooseGoodMiddle();return[lnn.path.middle,lnn.path.exit]};lnn.path.obeyMinimalConstraints=function(a){var c=lnn.path.descriptorsMap[a.identity],b=a.flags;return void 0!==c&&b.includes("Valid")&&b.includes("Running")&&a.version.startsWith("Tor 0.3.")&&"ed25519"===c.identity.type?!0:!1};
lnn.path.weightedRandomChoice=function(a){for(var c=0,b=$jscomp.makeIterator(a),d=b.next();!d.done;d=b.next())d=lnn.path.descriptorsMap[d.value.identity],void 0!==d&&(c+=d.bandwidth.avg);c*=Math.random();b=0;a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=a.next())if(d=lnn.path.descriptorsMap[d.value.identity],void 0!==d){var e=d.bandwidth.avg;if(b+e>=c)return d;b+=e}throw"No candidate has been chosen";};
lnn.path.inSame16Subnet=function(a,c){if(lnn.path.isChutney)return!1;var b=a.router.address.split("."),d=c.router.address.split(".");return b[0]===d[0]&&b[1]===d[1]};lnn.path.inSameFamily=function(a,c){if(void 0!=a.family&&void 0!=c.family)for(var b=$jscomp.makeIterator(a.family),d=b.next();!d.done;d=b.next())if(c.family.includes(d.value))return!0;return!1};lnn.path.chooseGoodExit=function(){var a=lnn.path.consensus.filter(lnn.path.isGoodExit);return lnn.path.weightedRandomChoice(a)};
lnn.path.chooseGoodExitGivenGuard=function(a){var c=lnn.path.consensus.filter(function(b){return lnn.path.isGoodExitGivenGuard(b,a)});console.log("Exit candidates: "+c.length);return lnn.path.weightedRandomChoice(c)};lnn.path.isGoodExit=function(a){var c=a.flags;if(!c.includes("Exit")||c.includes("BadExit"))return!1;void 0===a["exit-policy"]&&(a["exit-policy"]=lnn.path.descriptorsMap[a.identity].policy);return"accept"!==a["exit-policy"].type?!1:!0};
lnn.path.isGoodExitGivenGuard=function(a,c){var b=a.flags;if(!b.includes("Exit")||b.includes("BadExit"))return!1;b=lnn.path.descriptorsMap[a.identity];void 0===a["exit-policy"]&&(a["exit-policy"]=b.policy);var d=a["exit-policy"].PortList;for(i=0;i<c.length;i++){var e=!1,f=c[i];for(j=0;j<d.length;j++)if(d[j][0]==f){e=!0;break}else if(2==d[j].length&&d[j][0]<=f&&f<=d[j][1]){e=!0;break}if("accept"==a["exit-policy"].type){if(!e)return!1}else if(e)return!1}return void 0===b||b.router.identity===lnn.path.guard.router.identity||
lnn.path.inSame16Subnet(b,lnn.path.guard)||lnn.path.inSameFamily(b,lnn.path.guard)?!1:!0};lnn.path.chooseGoodGuard=function(){var a=lnn.path.consensus.filter(function(a){return lnn.path.isGoodGuard(a)});return lnn.path.weightedRandomChoice(a)};
lnn.path.isGoodGuard=function(a){var c=a.flags;a=lnn.path.descriptorsMap[a.identity];return void 0!==a&&a.router.identity!==lnn.path.exit.router.identity&&c.includes("Guard")&&c.includes("Stable")&&c.includes("V2Dir")&&!lnn.path.inSame16Subnet(a,lnn.path.exit)&&!lnn.path.inSameFamily(a,lnn.path.exit)?!0:!1};lnn.path.chooseGoodMiddle=function(){var a=lnn.path.consensus.filter(function(a){return lnn.path.isGoodMiddle(a)});return lnn.path.weightedRandomChoice(a)};
lnn.path.isGoodMiddle=function(a){a=lnn.path.descriptorsMap[a.identity];return void 0===a||a.router.identity===lnn.path.exit.router.identity||a.router.identity===lnn.path.guard.router.identity||lnn.path.inSame16Subnet(a,lnn.path.guard)||lnn.path.inSame16Subnet(a,lnn.path.exit)||lnn.path.inSameFamily(a,lnn.path.guard)||lnn.path.inSameFamily(a,lnn.path.exit)?!1:!0};window.lnn=lnn;
